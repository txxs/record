(window.webpackJsonp=window.webpackJsonp||[]).push([[1201],{1595:function(s,a,n){"use strict";n.r(a);var e=n(13),t=Object(e.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("触发器,函数,存储过程")]),s._v(" "),n("h1",{attrs:{id:"_1-存储过程与函数的区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-存储过程与函数的区别"}},[s._v("#")]),s._v(" 1 存储过程与函数的区别")]),s._v(" "),n("p",[s._v("本质上没区别，执行的本质都一样。")]),s._v(" "),n("p",[s._v("函数有且只能返回一个变量\n存储过程可以返回多个")]),s._v(" "),n("p",[s._v("函数可以嵌入在sql中使用的,可以在select中调用\n存储过程要让sql的query 可以执行， 需要把 "),n("code",[s._v("mysql_real_connect")]),s._v(" 的最后一个参数设置为"),n("code",[s._v("CLIENT_MULTI_STATEMENTS")])]),s._v(" "),n("p",[s._v("函数限制比较多，比如不能用临时表，只能用表变量．还有一些函数都不可用等等．\n存储过程的限制相对就比较少。")]),s._v(" "),n("p",[s._v("1）存储过程实现的功能要复杂一点,功能强大，可以执行包括修改表等一系列数据库操作\n函数的实现的功能针对性比较强,用户定义函数不能用于执行一组修改全局数据库状态的操作。")]),s._v(" "),n("p",[s._v("2）存储过程来说可以返回参数，如记录集，而函数只能返回值或者表对象\n函数只能返回一个变量；而存储过程可以返回多个。存储过程的参数可以有IN,OUT,INOUT三种类型，而函数只能有IN类~~存储过程声明时不需要返回类型，而函数声明时需要描述返回类型，且函数体中必须包含一个有效的RETURN语句。")]),s._v(" "),n("p",[s._v("3）存储过程，可以使用非确定函数，不允许在用户定义函数主体中内置非确定函数。")]),s._v(" "),n("p",[s._v("4）存储过程一般是作为一个独立的部分来执行（ EXECUTE 语句执行），而函数可以作为查询语句的一个部分来调用（SELECT调用），由于函数可以返回一个表对象，因此它可以在查询语句中位于FROM关键字的后面。 SQL语句中不可用存储过程，而可以使用函数。")]),s._v(" "),n("p",[s._v("当存储过程和函数被执行的时候，SQL Manager会到procedure cache中去取相应的查询语句，如果在procedure cache里没有相应的查询语句，SQL Manager就会对存储过程和函数进行编译。")]),s._v(" "),n("p",[s._v("Procedure cache中保存的是执行计划 (execution plan) ，当编译好之后就执行execution plan\n之后SQL SERVER会根据每个execution plan的实际情况来考虑是否要在cache中保存这个plan，评判的标准一个是这个execution plan可能被使用的频率；其次是生成这个plan的代价，也就是编译的耗时。保存在cache中的plan在下次执行时就不用再编译了。")]),s._v(" "),n("h1",{attrs:{id:"_2-mysql存储过程的作用及语法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-mysql存储过程的作用及语法"}},[s._v("#")]),s._v(" 2 MYSql存储过程的作用及语法")]),s._v(" "),n("p",[n("strong",[s._v("作用：")]),s._v(" \n　　1、使用存过过程，很多相似性的删除，更新，新增等操作就变得轻松了，并且以后也便于管理！ \n　　2、存储过程因为SQL语句已经预编绎过了，因此运行的速度比较快。 \n　　3、存储过程可以接受参数、输出参数、返回单个或多个结果集以及返回值。可以向程序返回错误原因。 \n　　4、存储过程运行比较稳定，不会有太多的错误。只要一次成功，以后都会按这个程序运行。 \n　　5、存储过程主要是在服务器上运行，减少对客户机的压力。 \n　　6、存储过程可以包含程序流、逻辑以及对数据库的查询。同时可以实体封装和隐藏了数据逻辑。 \n　　7、存储过程可以在单个存储过程中执行一系列SQL语句。 \n　　8、存储过程可以从自己的存储过程内引用其它存储过程，这可以简化一系列复杂语句。")]),s._v(" "),n("p",[n("strong",[s._v("一、创建存储过程")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("create procedure sp_name()\nbegin\n.........\nend\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("strong",[s._v("二、调用存储过程")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("call sp_name()\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("注意：存储过程名称后面必须加括号，哪怕该存储过程没有参数传递")]),s._v(" "),n("p",[n("strong",[s._v("三、删除存储过程")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("drop procedure sp_name//\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("注意：不能在一个存储过程中删除另一个存储过程，只能调用另一个存储过程")]),s._v(" "),n("p",[n("strong",[s._v("四、区块，条件，循环")]),s._v(" "),n("strong",[s._v("1、区块定义，常用")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("begin\n......\nend;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("也可以给区块起别名，如：")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("lable:begin\n...........\nend lable;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("可以用leave lable;跳出区块，执行区块以后的代码")]),s._v(" "),n("p",[n("strong",[s._v("2、条件语句")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("if 条件 then\nstatement\nelse\nstatement\nend if;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("3、循环语句")]),s._v(" "),n("strong",[s._v("(1)while循环")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[label:] WHILE expression DO\n\nstatements\n\nEND WHILE [label] ;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("(2)、loop循环")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[label:] LOOP\n\nstatements\n\nEND LOOP [label];\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("(3)、repeat until循环")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[label:] REPEAT\n\nstatements\n\nUNTIL expression\n\nEND REPEAT [label] ;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("五、其他常用命令")]),s._v(" \n1.show procedure status \n显示数据库中所有存储的存储过程基本信息，包括所属数据库，存储过程名称，创建时间等 \n2.show create procedure sp_name \n显示某一个存储过程的详细信息")]),s._v(" "),n("p",[n("strong",[s._v("函数function示例")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE DEFINER=`root`@`%` FUNCTION `spr_checkadmin`(acckey varchar(32), accpwd varchar(64)) RETURNS int(11)\nBEGIN\nDECLARE x INT;\nSELECT COUNT(*) INTO x FROM admins WHERE account=acckey AND passwd=accpwd;\nRETURN(x);\nEND;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("单个返回值的存储过程")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE DEFINER=`root`@`%` PROCEDURE `spr_getuserstorage`(tok varchar(128))\nBEGIN\nDECLARE acc VARCHAR(32);\nDECLARE pkgid VARCHAR(32);\nDECLARE regdate DATETIME;\nDECLARE logindate DATETIME;\nDECLARE sumsize BIGINT;\nSELECT account INTO acc FROM userinfo WHERE token=tok;\nIF (acc != NULL) THEN\nSELECT SUM(filesize) INTO sumsize FROM userfiles WHERE account=acc;\nSELECT packageid, registerdate, lastlogindate INTO pkgid, regdate, logindate FROM userinfo WHERE account=acc;\nSELECT 0,pkgid,regdate,logindate;\nELSE\nSELECT(-1);\nEND IF;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[n("strong",[s._v("多个返回值存储过程")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("CREATE DEFINER=`root`@`%` PROCEDURE `spr_queryfolderallfile`(sToken varchar(32), OUT sfid varchar(32), OUT sfext varchar(32))\nBEGIN\nDECLARE acc CHAR(32);\nSELECT account INTO acc FROM userinfo WHERE token=sToken;\nIF (acc != NULL) THEN\nSELECT fileid, fileext INTO sfid, sfext FROM userfiles WHERE account=acc AND filetype=1;\nEND IF;\nEND;\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);