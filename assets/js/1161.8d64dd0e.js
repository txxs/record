(window.webpackJsonp=window.webpackJsonp||[]).push([[1161],{1556:function(s,t,a){"use strict";a.r(t);var n=a(13),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_1-倒排索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-倒排索引"}},[s._v("#")]),s._v(" 1 倒排索引")]),s._v(" "),a("h2",{attrs:{id:"_1-1-书的目录和索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-书的目录和索引"}},[s._v("#")]),s._v(" 1.1 书的目录和索引")]),s._v(" "),a("ul",[a("li",[s._v("正排索引即目录页，根据页码去找内容\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129161808638.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("li",[s._v("倒排索引即索引页，根据关键词去找对应页码\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2020112916291086.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})])]),s._v(" "),a("h2",{attrs:{id:"_1-2-搜索引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-搜索引擎"}},[s._v("#")]),s._v(" 1.2 搜索引擎")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("正排索引\n文档Id =》文档内容、单词的关联关系")])]),s._v(" "),a("li",[a("p",[s._v("倒排索引\n单词 =》 文档Id的关联关系")])]),s._v(" "),a("li",[a("p",[s._v("左：正排索引 =》  右：倒排索引"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129170619832.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})])])]),s._v(" "),a("h3",{attrs:{id:"倒排索引查询流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#倒排索引查询流程"}},[s._v("#")]),s._v(" 倒排索引查询流程")]),s._v(" "),a("p",[s._v('查询包含"搜索引擎”的文档')]),s._v(" "),a("ol",[a("li",[s._v('通过倒排索引获得"搜索引擎”对应的文档Id有1和3')]),s._v(" "),a("li",[s._v("通过正排索引查询1和3的完整内容")]),s._v(" "),a("li",[s._v("返回最终结果")])]),s._v(" "),a("h2",{attrs:{id:"_1-3-倒排索引的组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-倒排索引的组成"}},[s._v("#")]),s._v(" 1.3 倒排索引的组成")]),s._v(" "),a("h3",{attrs:{id:"_1-3-1-单词词典-term-dictionary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-单词词典-term-dictionary"}},[s._v("#")]),s._v(" 1.3.1 单词词典( Term Dictionary )")]),s._v(" "),a("p",[s._v("倒排索引的重要组成")]),s._v(" "),a("ul",[a("li",[s._v("记录所有文档的单词 ，一般都比较大")]),s._v(" "),a("li",[s._v("记录单词到倒排列表的关联信息")])]),s._v(" "),a("p",[s._v("单词字典的实现一般是用B+ Tree ,示例如下\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129170634601.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_1-3-2-倒排列表-posting-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-倒排列表-posting-list"}},[s._v("#")]),s._v(" 1.3.2 倒排列表( Posting List )")]),s._v(" "),a("p",[s._v("记录了单词对应的文档集合，由倒排索引项( Posting )组成。")]),s._v(" "),a("p",[s._v("倒排索引项( Posting )主要包含如下信息：")]),s._v(" "),a("ul",[a("li",[s._v("文档Id ,用于获取原始信息")]),s._v(" "),a("li",[s._v("单词频率( TF, Term Frequency )，记录该单词在该文档中的出现次数，用于后续相关性算分")]),s._v(" "),a("li",[s._v("位置( Position)\n记录单词在文档中的分词位置(多个) , 用于做词语搜索( Phrase Query )")]),s._v(" "),a("li",[s._v("偏移( Offset )\n记录单词在文档的开始和结束位置,用于做高亮显示")])]),s._v(" "),a("h4",{attrs:{id:"案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#案例"}},[s._v("#")]),s._v(" 案例")]),s._v(" "),a("p",[s._v("以搜索引擎为例\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129164921650.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("ul",[a("li",[s._v("单词字典与倒排列表整合在一起的结构"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129170713885.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})])]),s._v(" "),a("p",[s._v("ES存储的是JSON格式文档，其中包含多个字段，"),a("strong",[s._v("每个字段都有自己的倒排索引")]),s._v("。")]),s._v(" "),a("h1",{attrs:{id:"_2-分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-分词"}},[s._v("#")]),s._v(" 2 分词")]),s._v(" "),a("p",[s._v("将文本转换成一系列单词的过程，也称文本分析，在 ES 里称为 Analysis。\n比如文本【JavaEdge 是最硬核的公众号】，分词结果是【JavaEdge、硬核、公众号】")]),s._v(" "),a("h2",{attrs:{id:"_2-1-analyzer-分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-analyzer-分词器"}},[s._v("#")]),s._v(" 2.1 Analyzer-分词器")]),s._v(" "),a("p",[s._v("分词器是 ES 专门处理分词的组件，组成如下：")]),s._v(" "),a("h3",{attrs:{id:"_2-1-1-character-filters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-character-filters"}},[s._v("#")]),s._v(" 2.1.1 Character Filters")]),s._v(" "),a("p",[s._v("在Tokenizer之前对原始文本进行处理,比如增加、删除或替换字符等。")]),s._v(" "),a("p",[s._v("针对原始文本进行处理，比如去除 html 特殊标记符，自带的如下：")]),s._v(" "),a("ul",[a("li",[s._v("HTML Strip 去除 html 标签和转换 html 实体")]),s._v(" "),a("li",[s._v("Mapping 进行字符替换操作")]),s._v(" "),a("li",[s._v("Pattern Replace 进行正则匹配替换")])]),s._v(" "),a("p",[s._v("会影响后续tokenizer解析的postion和offset信息\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129181928455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_2-1-2-tokenizer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-tokenizer"}},[s._v("#")]),s._v(" 2.1.2 Tokenizer")]),s._v(" "),a("p",[s._v("将原始文本按照一定规则切分为单词，内置：")]),s._v(" "),a("ul",[a("li",[s._v("standard 按单词进行分割")]),s._v(" "),a("li",[s._v("letter 按非字符类进行分割")]),s._v(" "),a("li",[s._v("whitespace 按空格进行分割")]),s._v(" "),a("li",[s._v("UAX URL Email 按 standard 分割，但不会分割邮箱和 url")]),s._v(" "),a("li",[s._v("NGram 和 Edge NGram 连词分割")]),s._v(" "),a("li",[s._v("Path Hierachy 按文件路径进行分割")])]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("POST _analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokenizer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"path_hierarchy"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/one/two/three"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129182214960.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"_2-1-3-token-filters"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-token-filters"}},[s._v("#")]),s._v(" 2.1.3 Token Filters")]),s._v(" "),a("p",[s._v("针对 tokenizer 处理的单词进行再加工，比如转小写、删除或新增等处理，内置：")]),s._v(" "),a("ul",[a("li",[s._v("lowercase 将所有 term 转换为小写")]),s._v(" "),a("li",[s._v("stop 删除 stop words")]),s._v(" "),a("li",[s._v("NGram 和 Edge NGram 连词分割")]),s._v(" "),a("li",[s._v("Synonym 添加近义词的 term")])]),s._v(" "),a("p",[s._v("示例")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("// filter 可以有多个\nPOST _analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a Hello world!"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokenizer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stop"')]),s._v(", // 把 a 去掉了\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lowercase"')]),s._v(",// 小写\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ngram"')]),s._v(",\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"min_gram"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v(",\n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_gram"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n// 得到 hell、ello、worl、orld\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129182401976.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"分词器的调用顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词器的调用顺序"}},[s._v("#")]),s._v(" 分词器的调用顺序")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129170728664.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h1",{attrs:{id:"_3-analyze-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-analyze-api"}},[s._v("#")]),s._v(" 3 Analyze API")]),s._v(" "),a("p",[s._v("ES 提供了一个测试分词的 API 接口，方便验证分词效果，endpoint 是 _analyze：")]),s._v(" "),a("h2",{attrs:{id:"_3-1-指定-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-指定-analyzer"}},[s._v("#")]),s._v(" 3.1 指定 analyzer")]),s._v(" "),a("p",[s._v("request")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("POST _analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"analyzer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分词器")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('" JavaEdge 公众号"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试文本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("response")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokens"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"token"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分词结果")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start_offset"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 起始偏移")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"end_offset"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 结束偏移")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<ALPHANUM>"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"position"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 分词位置")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"token"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"edge"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start_offset"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"end_offset"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<ALPHANUM>"')]),s._v(",\n      "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"position"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/2020112917134040.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_3-2-指定索引中的字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-指定索引中的字段"}},[s._v("#")]),s._v(" 3.2 指定索引中的字段")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("POST  测试的索引/_analyze  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"field"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试字段")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试文本")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129172003321.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_3-3-自定义分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-自定义分词器"}},[s._v("#")]),s._v(" 3.3 自定义分词器")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("POST _analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokenizer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lowercase"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自定义")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("之前的默认分词器大写\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129172934744.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_16,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("li",[s._v("自定义小写分词器\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129173012446.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})])]),s._v(" "),a("h1",{attrs:{id:"_4-内置分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-内置分词器"}},[s._v("#")]),s._v(" 4 内置分词器")]),s._v(" "),a("h2",{attrs:{id:"standard-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#standard-analyzer"}},[s._v("#")]),s._v(" Standard Analyzer")]),s._v(" "),a("p",[a("strong",[s._v("默认分词器")]),s._v("，按词切分，支持多语言，小写处理")]),s._v(" "),a("h2",{attrs:{id:"simple-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#simple-analyzer"}},[s._v("#")]),s._v(" Simple Analyzer")]),s._v(" "),a("p",[s._v("按照非字母切分，小写处理")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129174248953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"whitespace-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whitespace-analyzer"}},[s._v("#")]),s._v(" Whitespace Analyzer")]),s._v(" "),a("ul",[a("li",[s._v("按空格切分\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129174411558.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})])]),s._v(" "),a("h2",{attrs:{id:"stop-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stop-analyzer"}},[s._v("#")]),s._v(" Stop Analyzer")]),s._v(" "),a("p",[s._v("Stop Word 指语气助词等修饰性词语，比如 the、an、的、这等等，特性是相比 Simple Analyzer 多 Stop Word 处理\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129174542424.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"keyword-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keyword-analyzer"}},[s._v("#")]),s._v(" keyword Analyzer")]),s._v(" "),a("p",[s._v("不分词，直接将输入作为一个单词输出\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129174556118.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"pattern-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pattern-analyzer"}},[s._v("#")]),s._v(" Pattern Analyzer")]),s._v(" "),a("p",[s._v("通过正则表达式自定义分隔符，默认 \\W+，即非字词的符号为分隔符\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129174618162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"language-analyzer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#language-analyzer"}},[s._v("#")]),s._v(" Language Analyzer")]),s._v(" "),a("p",[s._v("提供了 30+ 常见语言的分词器")]),s._v(" "),a("h1",{attrs:{id:"_5-中文分词"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-中文分词"}},[s._v("#")]),s._v(" 5 中文分词")]),s._v(" "),a("p",[s._v("将一个汉字序列切分成一个个单独的词。在英文中，单词之间是以空格作为自然分界符，汉语中词没有一个形式上的分界符。而且中文博大精深，上下文不同，分词结果也大不相同。\n比如：")]),s._v(" "),a("ul",[a("li",[s._v("乒乓球拍/卖/完了")]),s._v(" "),a("li",[s._v("乒乓球/拍卖/完了")])]),s._v(" "),a("p",[s._v("以下是 ES 中常见的分词系统：")]),s._v(" "),a("h3",{attrs:{id:"ik"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ik"}},[s._v("#")]),s._v(" IK")]),s._v(" "),a("p",[s._v("实现中英文单词的切分，可自定义词库，支持热更新分词词典")]),s._v(" "),a("h3",{attrs:{id:"jieba"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jieba"}},[s._v("#")]),s._v(" jieba")]),s._v(" "),a("p",[s._v("python 中最流行饿分词系统，支持分词和词性标注，支持繁体分词，自定义词典，并行分词")]),s._v(" "),a("p",[s._v("以下是基于自然语言处理的分词系统：")]),s._v(" "),a("h3",{attrs:{id:"hanlp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hanlp"}},[s._v("#")]),s._v(" Hanlp")]),s._v(" "),a("p",[s._v("由一系列模型与算法组成的 java 工具包，支持索引分词、繁体分词、简单匹配分词（极速模式）、基于 CRF 模型的分词、N- 最短路径分词等，实现了不少经典分词方法。目标是普及自然语言处理在生产环境中的应用。\nhttps://github.com/hankcs/HanLP")]),s._v(" "),a("h3",{attrs:{id:"thulac"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thulac"}},[s._v("#")]),s._v(" THULAC")]),s._v(" "),a("ul",[a("li",[s._v("THU Lexical Analyzer for Chinese ,由清华大学自然语言处理与社会人文计算\n实验室研制推出的一套中文词法分析工具包，具有中文分词和词性标注功能\nhttps://github.com/microbun/elasticsearch-thulac-plugin")])]),s._v(" "),a("h1",{attrs:{id:"_6-自定义分词器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-自定义分词器"}},[s._v("#")]),s._v(" 6 自定义分词器")]),s._v(" "),a("p",[s._v("当自带的分词无法满足需求时，可以自定义分词器，通过定义 Character Filters、Tokenizer、Token Filter 实现。自定义的分词需要在索引的配置中设定，示例如下所示：")]),s._v(" "),a("ul",[a("li",[s._v("自定义如下分词器\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129182929451.png",alt:""}})])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("// 自定义分词器\nPUT test_index_name\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"settings"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"analysis"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"analyzer"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my_customer_analyzer"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"custome"')]),s._v(",\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokenizer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"standard"')]),s._v(",\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"char_filter"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"html_strip"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"filter"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lowercase"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"asciifolding"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n// 测试自定义分词器效果：\nPOST test_index/_analyze\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tokenizer"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keyword"')]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"char_filter"')]),s._v(":"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"html_strip"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Is this <b>a box</b>?"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n// 得到 is、this、a、box\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h1",{attrs:{id:"_7-分词使用说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-分词使用说明"}},[s._v("#")]),s._v(" 7 分词使用说明")]),s._v(" "),a("p",[s._v("分词会在如下两个时机使用：")]),s._v(" "),a("h2",{attrs:{id:"创建或者更新文档时-index-time"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建或者更新文档时-index-time"}},[s._v("#")]),s._v(" 创建或者更新文档时（Index Time）")]),s._v(" "),a("p",[s._v("会对相应的文档进行分词处理")]),s._v(" "),a("p",[s._v("索引时分词是通过配置Index Mapping中每个字段的analyzer属性实现的。不指定分词时，使用默认standard。")]),s._v(" "),a("h2",{attrs:{id:"查询时-search-time"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询时-search-time"}},[s._v("#")]),s._v(" 查询时（Search Time）")]),s._v(" "),a("p",[s._v("会对查询语句进行分词。查询时分词的指定方式：")]),s._v(" "),a("ul",[a("li",[s._v("查询的时候通过analyzer指定分词器")]),s._v(" "),a("li",[s._v("通过index mapping设置 "),a("code",[s._v("search_analyzer")]),s._v(" 实现")])]),s._v(" "),a("h2",{attrs:{id:"分词的最佳实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分词的最佳实践"}},[s._v("#")]),s._v(" 分词的最佳实践")]),s._v(" "),a("ul",[a("li",[s._v("明确字段是否需要分词，不需要分词的字段就将 type 设置为 keyword，可以节省空间和提高写性能。")]),s._v(" "),a("li",[s._v("善用 _analyze API,查看文档的具体分词结果")]),s._v(" "),a("li",[s._v("多动手测试")])]),s._v(" "),a("p",[s._v("参考")]),s._v(" "),a("ul",[a("li",[s._v("https://blog.csdn.net/weixin_38118016/article/details/90416391")]),s._v(" "),a("li",[s._v("https://mp.weixin.qq.com/s?__biz=MzU1NDA4NjU2MA==&mid=2247486148&idx=1&sn=817027a204650763c1bea3e837d695ea&source=41#wechat_redirect")])])])}),[],!1,null,null,null);t.default=e.exports}}]);