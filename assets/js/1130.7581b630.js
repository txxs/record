(window.webpackJsonp=window.webpackJsonp||[]).push([[1130],{1523:function(t,a,s){"use strict";s.r(a);var n=s(13),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_1-数据缓存设计结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-数据缓存设计结构"}},[t._v("#")]),t._v(" 1 数据缓存设计结构")]),t._v(" "),s("h2",{attrs:{id:"_1-1-一级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-一级缓存"}},[t._v("#")]),t._v(" 1.1  一级缓存")]),t._v(" "),s("p",[t._v("Session会话级别的缓存，位于表示一次数据库会话的"),s("code",[t._v("SqlSession")]),t._v("对象之中，即"),s("code",[t._v("本地缓存")]),t._v("。")]),t._v(" "),s("p",[t._v("一级缓存是MyBatis内部实现的一个特性，"),s("code",[t._v("用户不能配置")]),t._v("，"),s("code",[t._v("默认自动支持")]),t._v("，用户无定制权利。")]),t._v(" "),s("h2",{attrs:{id:"_1-2-二级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-二级缓存"}},[t._v("#")]),t._v(" 1.2 二级缓存")]),t._v(" "),s("p",[t._v("Application应用级别的缓存，生命周期长，跟"),s("strong",[t._v("Application")]),t._v("的生命周期一样，即作用范围为整个"),s("strong",[t._v("Application")]),t._v("应用。")]),t._v(" "),s("ul",[s("li",[t._v("缓存架构\n"),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/467c160b28d36dbc89025aae196fa514.png",alt:""}})])]),t._v(" "),s("h1",{attrs:{id:"_2-工作机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-工作机制"}},[t._v("#")]),t._v(" 2 工作机制")]),t._v(" "),s("h2",{attrs:{id:"_2-1-一级缓存的工作机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-一级缓存的工作机制"}},[t._v("#")]),t._v(" 2.1 一级缓存的工作机制")]),t._v(" "),s("p",[t._v("一级缓存是"),s("strong",[t._v("Session")]),t._v("级别，一般一个"),s("strong",[t._v("SqlSession")]),t._v("对象会使用一个"),s("strong",[t._v("Executor")]),t._v("对象来完成会话操作，"),s("strong",[t._v("Executor")]),t._v("对象会维护一个"),s("strong",[t._v("Cache")]),t._v("缓存，以提高查询性能。\n"),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/b8e294c3fca853664aa4397656f9f640.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"_2-2-二级缓存的工作机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-二级缓存的工作机制"}},[t._v("#")]),t._v(" 2.2 二级缓存的工作机制")]),t._v(" "),s("p",[t._v("一个"),s("strong",[t._v("SqlSession")]),t._v("对象会使用一个"),s("strong",[t._v("Executor")]),t._v("对象来完成会话操作，"),s("strong",[t._v("MyBatis")]),t._v("的二级缓存机制的关键就是对这个"),s("strong",[t._v("Executor")]),t._v("对象做文章")]),t._v(" "),s("p",[t._v("如果用户配置了"),s("code",[t._v("cacheEnabled=true")]),t._v("，那么在为"),s("strong",[t._v("SqlSession")]),t._v("对象创建"),s("strong",[t._v("Executor")]),t._v("对象时，会对"),s("strong",[t._v("Executor")]),t._v("对象加上一个装饰者 "),s("code",[t._v("CachingExecutor")]),t._v("，这时"),s("strong",[t._v("SqlSession")]),t._v("使用"),s("code",[t._v("CachingExecutor")]),t._v("对象来完成操作请求\n"),s("strong",[t._v("CachingExecutor")]),t._v("对于查询请求，会先判断该查询请求在"),s("strong",[t._v("Application")]),t._v("级别的二级缓存中是否有缓存结果")]),t._v(" "),s("ul",[s("li",[t._v("如果有查询结果，则直接返回缓存结果")]),t._v(" "),s("li",[t._v("如果缓存未命中，再交给真正的"),s("strong",[t._v("Executor")]),t._v("对象来完成查询操作，之后"),s("strong",[t._v("CachingExecutor")]),t._v("会将真正"),s("strong",[t._v("Executor")]),t._v("返回的查询结果放置到缓存中，然后再返回给用户")])]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("的二级缓存设计得比较灵活，可以使用"),s("strong",[t._v("MyBatis")]),t._v("自己定义的二级缓存实现。也可通过实现"),s("strong",[t._v("org.apache.ibatis.cache.Cache")]),t._v("接口自定义缓存\n也可以使用第三方内存缓存库，如"),s("strong",[t._v("Memcached")]),t._v("等。\n"),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/ce84ae9d34d83b3f148b9d08132765e7.png",alt:""}}),t._v(" "),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/b40150aeace181dcbc50d6ddfa4190f2.png",alt:""}})]),t._v(" "),s("h1",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("p",[t._v("MyBatis:")]),t._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("cache")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("org.mybatis.caches.ehcache.LoggingEhcache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("memoryStoreEvictionPolicy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("LRU"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("cache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("select")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("selectArticleListPage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("resultMap")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("resultUserArticleList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("useCache")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("false"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);