(window.webpackJsonp=window.webpackJsonp||[]).push([[293],{690:function(s,t,a){"use strict";a.r(t);var e=a(13),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("img",{attrs:{src:"http://images2017.cnblogs.com/blog/719930/201709/719930-20170903171704624-1917697781.png",alt:"image"}})]),s._v(" "),a("h4",{attrs:{id:"hystrix是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hystrix是什么"}},[s._v("#")]),s._v(" Hystrix是什么？")]),s._v(" "),a("p",[s._v("hystrix对应的中文名字是“豪猪”，豪猪周身长满了刺，能保护自己不受天敌的伤害，代表了一种防御机制，这与hystrix本身的功能不谋而合，因此Netflix团队将该框架命名为Hystrix，并使用了对应的卡通形象做作为logo。")]),s._v(" "),a("p",[s._v("在一个分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，如何能够保证在一个依赖出问题的情况下，不会导致整体服务失败，这个就是Hystrix需要做的事情。Hystrix提供了熔断、隔离、Fallback、cache、监控等功能，能够在一个、或多个依赖同时出现问题时保证系统依然可用。")]),s._v(" "),a("h4",{attrs:{id:"为什么需要hystrix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要hystrix"}},[s._v("#")]),s._v(" 为什么需要Hystrix?")]),s._v(" "),a("p",[s._v("在大中型分布式系统中，通常系统很多依赖(HTTP,hession,Netty,Dubbo等)，如下图:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://dl2.iteye.com/upload/attachment/0103/1037/887e7862-578a-3616-a15c-1ef1cb62f3c4.png",alt:"image"}})]),s._v(" "),a("p",[s._v("在高并发访问下,这些依赖的稳定性与否对系统的影响非常大,但是依赖有很多不可控问题:如网络连接缓慢，资源繁忙，暂时不可用，服务脱机等。")]),s._v(" "),a("p",[s._v("如下图：QPS为50的依赖 I 出现不可用，但是其他依赖仍然可用。")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://dl2.iteye.com/upload/attachment/0103/1039/3bd6d0be-9ce5-35c2-bbd9-3493671b45d5.png",alt:"image"}})]),s._v(" "),a("p",[s._v("当依赖I 阻塞时,大多数服务器的线程池就出现阻塞(BLOCK),影响整个线上服务的稳定性.如下图:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://dl2.iteye.com/upload/attachment/0103/1041/22f20da1-4096-314c-8c9f-5728251c46af.png",alt:"image"}})]),s._v(" "),a("p",[s._v("在复杂的分布式架构的应用程序有很多的依赖，都会不可避免地在某些时候失败。高并发的依赖失败时如果没有隔离措施，当前应用服务就有被拖垮的风险。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("例如:一个依赖30个SOA服务的系统,每个服务99.99%可用。  \n99.99%的30次方 ≈ 99.7%  \n0.3% 意味着一亿次请求 会有 3,000,00次失败  \n换算成时间大约每月有2个小时服务不稳定.  \n随着服务依赖数量的变多，服务不稳定的概率会成指数性提高.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("解决问题方案:对依赖做隔离,Hystrix就是处理依赖隔离的框架,同时也是可以帮我们做依赖服务的治理和监控。")]),s._v(" "),a("p",[s._v("Netflix 公司开发并成功使用Hystrix,使用规模如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("The Netflix API processes 10+ billion HystrixCommand executions per day using thread isolation.   \nEach API instance has 40+ thread-pools with 5-20 threads in each (most are set to 10).\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"hystrix如何解决依赖隔离"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hystrix如何解决依赖隔离"}},[s._v("#")]),s._v(" Hystrix如何解决依赖隔离？")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("Hystrix使用命令模式HystrixCommand(Command)包装依赖调用逻辑，每个命令在单独线程中/信号授权下执行。")])]),s._v(" "),a("li",[a("p",[s._v("可配置依赖调用超时时间,超时时间一般设为比99.5%平均时间略高即可.当调用超时时，直接返回或执行fallback逻辑。")])]),s._v(" "),a("li",[a("p",[s._v("为每个依赖提供一个小的线程池（或信号），如果线程池已满调用将被立即拒绝，默认不采用排队.加速失败判定时间。")])]),s._v(" "),a("li",[a("p",[s._v("依赖调用结果分:成功，失败（抛出异常），超时，线程拒绝，短路。 请求失败(异常，拒绝，超时，短路)时执行fallback(降级)逻辑。")])]),s._v(" "),a("li",[a("p",[s._v("提供熔断器组件,可以自动运行或手动调用,停止当前依赖一段时间(10秒)，熔断器默认错误率阈值为50%,超过将自动运行。")])]),s._v(" "),a("li",[a("p",[s._v("提供近实时依赖的统计和监控。")])])]),s._v(" "),a("p",[s._v("Hystrix依赖的隔离架构,如下图:")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://dl2.iteye.com/upload/attachment/0103/1043/8db93de3-db14-355f-ac70-16d06481b020.png",alt:"image"}})]),s._v(" "),a("h4",{attrs:{id:"hystrix应用实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hystrix应用实战"}},[s._v("#")]),s._v(" Hystrix应用实战")]),s._v(" "),a("p",[a("strong",[s._v("Maven")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<dependency>\n    <groupId>com.netflix.hystrix</groupId>\n    <artifactId>hystrix-core</artifactId>\n    <version>1.5.13</version>\n</dependency>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("源码太多，不一一贴上来，这里只展示主要的测试源码。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('public static void main(String[] args) {\n    System.out.println(test("javastack"));\n}\n\nprivate static String test(String name) {\n    HystrixUtil.HystrixReqConfig hc = HystrixUtil.HystrixReqConfig.withGroupKey("TestGroup").withTimeout(3)\n            .withUnit(TimeUnit.SECONDS).withPassNum(64);\n\n    String result = HystrixUtil.getExcuteResult(new HystrixCallableService<String>() {\n\n        @Override\n        public String execute() {\n            try {\n                Thread.sleep(5000);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            return "success " + name;\n        }\n\n        @Override\n        public String fallback() {\n            return "fallback " + name;\n        }\n\n    }, hc);\n\n    return result;\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[s._v("这里设置了3秒超时进入熔断。")]),s._v(" "),a("p",[s._v("测试程序中休眠5秒，进入熔断器并输出：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("fallback javastack\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("测试程序中休眠2秒，进入正常流程并输出：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("success javastack\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("熔断器测试成功，即使某个服务出问题，也不会影响整个系统的正常运行。")]),s._v(" "),a("p",[s._v('获取全部打包源码可以在公众号菜单中回复"微信群"加入微信群，并在对应的群文件中下载。')])])}),[],!1,null,null,null);t.default=n.exports}}]);