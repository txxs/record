(window.webpackJsonp=window.webpackJsonp||[]).push([[289],{680:function(t,e,v){"use strict";v.r(e);var r=v(13),_=Object(r.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"table-of-contents"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[t._v("#")]),t._v(" Table of Contents")]),t._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"#41-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"}},[t._v("4.1 配置文件")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#42-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%91%BD%E4%BB%A4"}},[t._v("4.2 服务端命令")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#43-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%91%BD%E4%BB%A4"}},[t._v("4.3 客户端命令")]),t._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"#431-%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E5%88%97%E8%A1%A8"}},[t._v("4.3.1 查看节点列表")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#432-%E5%88%9B%E5%BB%BA%E6%96%B0%E8%8A%82%E7%82%B9"}},[t._v("4.3.2 创建新节点")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#433-%E6%9F%A5%E7%9C%8B%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE"}},[t._v("4.3.3 查看节点数据")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#434-%E4%BF%AE%E6%94%B9%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE"}},[t._v("4.3.4 修改节点数据")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#435-%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9"}},[t._v("4.3.5 删除节点")])])])]),t._v(" "),v("li",[v("a",{attrs:{href:"#44-zookeeper%E5%9B%9B%E5%AD%97%E5%91%BD%E4%BB%A4"}},[t._v("4.4 ZooKeeper四字命令")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#51-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"}},[t._v("5.1 集群配置")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#52-%E9%9B%86%E7%BE%A4%E5%90%AF%E5%8A%A8"}},[t._v("5.2 集群启动")])]),t._v(" "),v("li",[v("a",{attrs:{href:"#53-%E9%9B%86%E7%BE%A4%E5%AE%B9%E7%81%BE"}},[t._v("5.3 集群容灾")])])]),t._v(" "),v("p",[t._v("本文内容参考网络，侵删")]),t._v(" "),v("p",[t._v("本系列文章将整理到我在GitHub上的《Java面试指南》仓库，更多精彩内容请到我的仓库里查看")]),t._v(" "),v("blockquote",[v("p",[t._v("https://github.com/h2pl/Java-Tutorial")])]),t._v(" "),v("p",[t._v("喜欢的话麻烦点下Star哈")]),t._v(" "),v("p",[t._v("本文也将同步到我的个人博客：")]),t._v(" "),v("blockquote",[v("p",[t._v("www.how2playlife.com")])]),t._v(" "),v("p",[t._v("更多Java技术文章将陆续在微信公众号【Java技术江湖】更新，敬请关注。")]),t._v(" "),v("p",[t._v("该系列博文会告诉你什么是分布式系统，这对后端工程师来说是很重要的一门学问，我们会逐步了解常见的分布式技术、以及一些较为常见的分布式系统概念，同时也需要进一步了解zookeeper、分布式事务、分布式锁、负载均衡等技术，以便让你更完整地了解分布式技术的具体实战方法，为真正应用分布式技术做好准备。")]),t._v(" "),v("p",[t._v("如果对本系列文章有什么建议，或者是有什么疑问的话，也可以关注公众号【Java技术江湖】联系作者，欢迎你参与本系列博文的创作和修订。")]),t._v(" "),v("h2",{attrs:{id:"_4-1-配置文件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-配置文件"}},[t._v("#")]),t._v(" 4.1 配置文件")]),t._v(" "),v("p",[t._v("ZooKeeper安装好之后，在安装目录的conf文件夹下可以找到一个名为“"),v("strong",[t._v("zoo_sample.cfg")]),t._v("”的文件，是ZooKeeper配置文件的模板。")]),t._v(" "),v("p",[t._v("ZooKeeper启动时，会默认加载“conf/zoo.cfg”作为配置文件，所以需要将“"),v("strong",[t._v("zoo_sample.cfg")]),t._v("”复制一份，命名为“"),v("strong",[t._v("zoo.cfg")]),t._v("”，然后根据需要设定里面的配置项。")]),t._v(" "),v("p",[t._v("配置项很简单，说明如下：")]),t._v(" "),v("p",[t._v("tickTime=2000")]),t._v(" "),v("p",[t._v("这个时间是作为 ZooKeeper服务器之间或客户端与服务器之间维持"),v("strong",[t._v("心跳的时间间隔")]),t._v("，也就是每个 tickTime 时间就会发送一个心跳。单位为毫秒。")]),t._v(" "),v("p",[t._v("initLimit=10")]),t._v(" "),v("p",[t._v("这个配置项是用来配置 Leader接受Follower 初始化连接时"),v("strong",[t._v("最长能忍受多少个心跳时间间隔数")]),t._v("。当已经超过 10 个心跳的时间（也就是 tickTime）长度后 Leader还没有收到Follower的返回信息，那么表明这个Follower连接失败。总的时间长度就是 5*2000=10 秒。")]),t._v(" "),v("p",[t._v("syncLimit=5")]),t._v(" "),v("p",[t._v("这个配置项标识 Leader 与 Follower 之间发送消息，"),v("strong",[t._v("请求和应答时间长度，最长不能超过多少个tickTime 的时间长度")]),t._v("，总的时间长度就是5*2000=10 秒。")]),t._v(" "),v("p",[t._v("dataDir=/tmp/zookeeper")]),t._v(" "),v("p",[t._v("顾名思义就是 "),v("strong",[t._v("ZooKeeper保存数据的目录")]),t._v("，用于存放内存数据库快照的文件夹，同时用于集群的myid文件也存在这个文件夹里。默认情况下，ZooKeeper 将写数据的日志文件也保存在这个目录里。注意：一个配置文件只能包含一个dataDir字样，即使它被注释掉了。")]),t._v(" "),v("p",[t._v("clientPort=2181")]),t._v(" "),v("p",[t._v("这个端口就是客户端连接 ZooKeeper服务器的"),v("strong",[t._v("端口")]),t._v("，ZooKeeper 会监听这个端口，接受客户端的访问请求。")]),t._v(" "),v("p",[t._v("maxClientCnxns=60")]),t._v(" "),v("p",[v("strong",[t._v("最大的客户端连接数")]),t._v("，默认为60.")]),t._v(" "),v("p",[t._v("autopurge.snapRetainCount=3")]),t._v(" "),v("p",[t._v("autopurge.purgeInterval=1")]),t._v(" "),v("p",[t._v("客户端在与ZooKeeper交互过程中会产生非常多的日志，而且ZooKeeper也会将内存中的数据作为snapshot保存下来，这些数据是不会被自动删除的，这样磁盘中这些数据就会越来越多。不过可以通过这两个参数来设置，让zookeeper自动删除数据。autopurge.purgeInterval就是"),v("strong",[t._v("设置多少小时清理一次")]),t._v("。而autopurge.snapRetainCount是"),v("strong",[t._v("设置保留多少个snapshot，之前的则删除")]),t._v("。")]),t._v(" "),v("h2",{attrs:{id:"_4-2-服务端命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-服务端命令"}},[t._v("#")]),t._v(" 4.2 服务端命令")]),t._v(" "),v("p",[t._v("“zkServer.sh”脚本用于执行Zookeeper的启动、停止及状态查看等操作")]),t._v(" "),v("p",[t._v("利用“zkServer.sh help”命令，可以查看支持的参数：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094506241?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("可见，“zkServer.sh”可以附带的参数有：")]),t._v(" "),v("p",[t._v("（1）start：用于启动服务端")]),t._v(" "),v("p",[t._v("（2）stop：用于停止服务端")]),t._v(" "),v("p",[t._v("（3）restart：用于重启服务端")]),t._v(" "),v("p",[t._v("（4）status：用于查看服务端状态")]),t._v(" "),v("p",[t._v("以及用于前台启动、更新等操作的其他参数。")]),t._v(" "),v("p",[t._v("例如，使用命令“"),v("strong",[t._v("zkServer.sh start")]),t._v("”启动ZooKeeper服务端，该命令后面可以附带参数，用于指定配置文件的路径，比如“zkServer.sh start ../conf/ZooKeeper.cfg”,代表使用ZooKeeper.cfg作为配置文件，如果不指定路径，默认加载“conf/zoo.cfg”文件：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094527607?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("使用**“zkServer.sh stop**”停止服务端：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094541826?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("h2",{attrs:{id:"_4-3-客户端命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-客户端命令"}},[t._v("#")]),t._v(" 4.3 客户端命令")]),t._v(" "),v("p",[t._v("使用命令“"),v("strong",[t._v("zkCli.sh -server 127.0.0.1:2181")]),t._v("”可以连接到IP为“127.0.0.1”，端口为“2181”的ZooKeeper服务器。如果连接本机的2181端口，则后面的参数可以省略。如：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094633014?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("此时，输入“help”可以查看命令参数：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094654858?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"_4-3-1-查看节点列表"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-查看节点列表"}},[t._v("#")]),t._v(" 4.3.1 查看节点列表")]),t._v(" "),v("p",[t._v("在前面已经提到过，ZooKeeper维护者一个树形的数据结构，根节点为“/”。")]),t._v(" "),v("p",[t._v("“"),v("strong",[t._v("ls path")]),t._v("”用于查看路径path下的所有直接子节点：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094740687?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("可见，系统初始化的时候，根节点下会自动创建一个名为“zookeeper”的节点，用于存储ZooKeeper的管理信息。所以用户不能再根节点下创建同名的子节点。")]),t._v(" "),v("h3",{attrs:{id:"_4-3-2-创建新节点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-创建新节点"}},[t._v("#")]),t._v(" 4.3.2 创建新节点")]),t._v(" "),v("p",[t._v("“create path data”用于在path路径下创建一个新节点，携带数据data。")]),t._v(" "),v("p",[t._v("例如，在根节点下新建一个名为“firstNode”节点，存储的数据为“HelloWorld”：")]),t._v(" "),v("p",[t._v("./zkClient.sh -server 127.0.01")]),t._v(" "),v("p",[t._v("create /firstNode HelloWorld")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094755539?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"_4-3-3-查看节点数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-查看节点数据"}},[t._v("#")]),t._v(" 4.3.3 查看节点数据")]),t._v(" "),v("p",[t._v("“get path”用于获取path节点下的数据，例如：")]),t._v(" "),v("p",[t._v("get /firstNode")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094814110?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("除了返回节点存储的数据之外，还有一系列的元信息，如代表节点创建时间的“cZxid”、“ctime”（两种表示方法）；节点的修改时间“mZxid”、“mtime”等。")]),t._v(" "),v("h3",{attrs:{id:"_4-3-4-修改节点数据"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-修改节点数据"}},[t._v("#")]),t._v(" 4.3.4 修改节点数据")]),t._v(" "),v("p",[t._v("“"),v("strong",[t._v("set path data")]),t._v(" ”用于将path节点下的数据更改为data。")]),t._v(" "),v("p",[t._v("如，将“/firstNode”下的数据更改为“WorldHello”：")]),t._v(" "),v("p",[t._v("set /firstNode WorldHello")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026095005321?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"_4-3-5-删除节点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-5-删除节点"}},[t._v("#")]),t._v(" 4.3.5 删除节点")]),t._v(" "),v("p",[t._v("“delete path”用于删除path节点。")]),t._v(" "),v("p",[t._v("如，删除“/firstNode”节点：")]),t._v(" "),v("p",[t._v("delete /firstNode")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026094832782?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("此外，还有用于设置节点ACL、查看节点状态等其他命令，需要时可以查阅相关手册。")]),t._v(" "),v("h2",{attrs:{id:"_4-4-zookeeper四字命令"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-zookeeper四字命令"}},[t._v("#")]),t._v(" 4.4 ZooKeeper四字命令")]),t._v(" "),v("p",[t._v("ZooKeeper 支持某些特定的四字命令字母与其的交互。它们大多是查询命令，用来获取 ZooKeeper 服务的当前状态及相关信息。用户在客户端可以通过 telnet 或 nc 向 ZooKeeper 提交相应的命令。")]),t._v(" "),v("p",[t._v("如:")]),t._v(" "),v("p",[v("strong",[t._v("ZooKeeper四字命令")])]),t._v(" "),v("p",[t._v("conf")]),t._v(" "),v("p",[v("strong",[t._v("功能描述")])]),t._v(" "),v("p",[t._v("输出相关服务配置的详细信息")]),t._v(" "),v("p",[t._v("cons")]),t._v(" "),v("p",[t._v("列出"),v("strong",[t._v("所有连接到服务器的客户端的完全的连接 / 会话的详细信息")]),t._v("。包括“接受 / 发送”的包数量、会话 id 、操作延迟、最后的操作执行等等信息")]),t._v(" "),v("p",[t._v("dump")]),t._v(" "),v("p",[t._v("列出"),v("strong",[t._v("未经处理的会话和临时节点")])]),t._v(" "),v("p",[t._v("envi")]),t._v(" "),v("p",[t._v("输出关于"),v("strong",[t._v("服务环境的详细信息")]),t._v("（区别于 conf 命令）")]),t._v(" "),v("p",[t._v("reqs")]),t._v(" "),v("p",[t._v("列出"),v("strong",[t._v("未经处理的请求")])]),t._v(" "),v("p",[t._v("ruok")]),t._v(" "),v("p",[t._v("测试服务是否处于正确状态。如果确实如此，那么服务返回“ imok ”，否则不做任何相应")]),t._v(" "),v("p",[t._v("stat")]),t._v(" "),v("p",[t._v("输出关于"),v("strong",[t._v("性能和连接的客户端的列表")])]),t._v(" "),v("p",[t._v("wchs")]),t._v(" "),v("p",[t._v("列出"),v("strong",[t._v("服务器 watch 的详细信息")])]),t._v(" "),v("p",[t._v("wchc")]),t._v(" "),v("p",[t._v("通过 "),v("strong",[t._v("session")]),t._v(" 列出服务器 watch 的详细信息，它的输出是一个与 watch 相关的会话的列表")]),t._v(" "),v("p",[t._v("wchp")]),t._v(" "),v("p",[t._v("通过"),v("strong",[t._v("路径")]),t._v("列出服务器 watch 的详细信息。它输出一个与 session 相关的路径")]),t._v(" "),v("hr"),t._v(" "),v("p",[t._v("例如，查看配置信息：")]),t._v(" "),v("p",[t._v("“echo conf | nc 127.0.0.1 2181”：")]),t._v(" "),v("p",[t._v("nc为“NetCat”工具提供的命令，通常的Linux发行版中都带有NetCat。NetCat在网络工具中有“瑞士军刀”美誉，被设计为一个简单、可靠的网络工具，可通过TCP或UDP协议传输读写数据。")]),t._v(" "),v("p",[t._v("该命令的意思为，将“conf”命令传递给127.0.0.1的2181端口（即本机的ZooKeeper服务端口），并将响应打印出来：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161026095053040?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("在一台机器上运营一个ZooKeeper实例，称之为单机（Standalone）模式。单机模式有个致命的缺陷，一旦唯一的实例挂了，依赖ZooKeeper的应用全得完蛋。")]),t._v(" "),v("p",[t._v("实际应用当中，一般都是采用集群模式来部署ZooKeeper，集群中的Server为奇数（"),v("strong",[t._v("2N+1")]),t._v("）。只要集群中的多数（大于N+1台）Server活着，集群就能对外提供服务。")]),t._v(" "),v("p",[t._v("在每台机器上部署一个ZooKeeper实例，多台机器组成集群，称之为完全分布式集群。此外，还可以在仅有的一台机器上部署多个ZooKeeper实例，以伪集群模式运行。")]),t._v(" "),v("h2",{attrs:{id:"_5-1-集群配置"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-集群配置"}},[t._v("#")]),t._v(" 5.1 集群配置")]),t._v(" "),v("p",[t._v("下面我们来建一个3个实例的zookeeper伪分布式集群。")]),t._v(" "),v("p",[t._v("首先，需要为三个实例创建不同的配置文件：")]),t._v(" "),v("pre",[t._v("zk1.cfg的配置项如下：\n​\n tickTime=2000\n​\n initLimit=10\n​\n syncLimit=5\n​\n dataDir=/zk1/dataDir\n​\n clientPort=2181\n​\n server.1=127.0.0.1:2888:3888\n​\n server.2=127.0.0.1:2889:3889\n​\n server.3=127.0.0.1:2890:3890")]),t._v(" "),v("pre",[t._v("zk2.cfg的配置项如下：\n​\n tickTime=2000\n​\n initLimit=10\n​\n syncLimit=5\n​\n dataDir=/zk2/dataDir\n​\n clientPort=2182\n​\n server.1=127.0.0.1:2888:3888\n​\n server.2=127.0.0.1:2889:3889\n​\n server.3=127.0.0.1:2890:3890")]),t._v(" "),v("pre",[t._v("zk3.cfg的配置项如下：\n​\ntickTime=2000\n​\ninitLimit=10\n​\nsyncLimit=5\n​\ndataDir=/zk3/dataDir\n​\nclientPort=2183\n​\nserver.1=127.0.0.1:2888:3888\n​\nserver.2=127.0.0.1:2889:3889\n​\nserver.3=127.0.0.1:2890:3890")]),t._v(" "),v("p",[t._v("因为部署在同一台机器上，所以每个实例的dataDir、clientPort要做区分，其余配置保持一致。")]),t._v(" "),v("p",[t._v("需要注意的是，集群中所有的实例作为一个整体对外提供服务，集群中每个实例之间都互相连接，所以，每个配置文件中都要列出所有实例的映射关系。")]),t._v(" "),v("p",[t._v("在每个配置文件的末尾，有几行“server.A=B：C：D”这样的配置，其中， "),v("strong",[t._v("A")]),t._v(" 是一个数字，表示这个是"),v("strong",[t._v("第几号服务器")]),t._v("；B 是这个服务器的 "),v("strong",[t._v("ip 地址")]),t._v("；C 表示的是这个"),v("strong",[t._v("服务器与集群中的 Leader 服务器交换信息的端口")]),t._v("；D 表示的是万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的 Leader，而这个端口就是用来执行"),v("strong",[t._v("选举时服务器相互通信的端口")]),t._v("。如果是伪集群的配置方式，由于 B 都是一样，所以不同的 Zookeeper 实例通信端口号不能一样，所以要给它们分配不同的端口号。")]),t._v(" "),v("p",[t._v("除了修改 zoo.cfg 配置文件，集群模式下还要配置一个"),v("strong",[t._v("myid")]),t._v("文件，这个文件"),v("strong",[t._v("在 dataDir 目录下，文件里只有一个数据，就是 A 的值")]),t._v("(第几号服务器)，Zookeeper 启动时会读取这个文件，拿到里面的数据与配置信息比较从而判断到底是那个 Server。")]),t._v(" "),v("p",[v("strong",[t._v("上例中，需要在每个实例各自的dataDir目录下，新建myid文件，分别填写“1”、“2”、“3”。")])]),t._v(" "),v("h2",{attrs:{id:"_5-2-集群启动"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-集群启动"}},[t._v("#")]),t._v(" 5.2 集群启动")]),t._v(" "),v("p",[t._v("依次启动三个实例：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092116131?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("查看Server状态：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092128275?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("可见，现在的集群中，zk2充当着Leader角色，而zk1与zk3充当着Follower角色。")]),t._v(" "),v("p",[t._v("使用三个客户端连接三个Server，在zk1的客户端下，新增“/newNode”节点，储存数据“zk1”：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092143725?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("在zk2的客户端与查看该节点：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092201291?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("在zk3的客户端与查看该节点：")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092213463?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("可见，集群中的Server保持着数据同步。")]),t._v(" "),v("h2",{attrs:{id:"_5-3-集群容灾"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-集群容灾"}},[t._v("#")]),t._v(" 5.3 集群容灾")]),t._v(" "),v("p",[t._v("如果我们把身为Leader的zk2关闭，会发生什么呢？")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092228400?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("可见，集群自动完成了切换，zk3变成了Leader。实际应用中，如果集群中的Leader宕机了，或者Leader与超过半数的Follower失去联系，都会触发ZooKeeper的选举流程，选举出新的Leader之后继续对外服务。")]),t._v(" "),v("p",[t._v("如果我们再把zk3关闭，会发生什么呢？")]),t._v(" "),v("p",[v("img",{attrs:{src:"https://img-blog.csdn.net/20161027092241119?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center",alt:""}})]),t._v(" "),v("p",[t._v("可见，关闭zk3以后，由于集群中的可用Server只剩下一台（达不到集群总数的半数以上），"),v("strong",[t._v("集群将处于不可用的状态。")])])])}),[],!1,null,null,null);e.default=_.exports}}]);