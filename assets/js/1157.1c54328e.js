(window.webpackJsonp=window.webpackJsonp||[]).push([[1157],{1552:function(t,s,a){"use strict";a.r(s);var e=a(13),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"_1-lucene-vs-elasticsearch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-lucene-vs-elasticsearch"}},[t._v("#")]),t._v(" 1 lucene VS elasticsearch")]),t._v(" "),a("p",[t._v("lucene，最先进、功能最强大的Java搜索类库。直接基于lucene开发，非常复杂，api复杂（实现简单功能，写大量java代码），需要深入理解原理（各种索引结构）。")]),t._v(" "),a("p",[t._v("elasticsearch，基于lucene，隐藏复杂性，提供简单易用的restful api接口、java api接口（还有其他语言的api接口）\n（1）分布式的文档存储引擎\n（2）分布式的搜索引擎和分析引擎\n（3）分布式，支持PB级数据")]),t._v(" "),a("p",[t._v("开箱即用，优秀的默认参数，不需要任何额外设置，完全开源。")]),t._v(" "),a("h1",{attrs:{id:"_2-核心概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-核心概念"}},[t._v("#")]),t._v(" 2 核心概念")]),t._v(" "),a("h2",{attrs:{id:"_2-1-近实时-near-realtime-nrt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-近实时-near-realtime-nrt"}},[t._v("#")]),t._v(" 2.1 近实时-Near Realtime(NRT)")]),t._v(" "),a("p",[t._v("从写入数据到数据可以被搜索到有一个小延迟（大概1秒），基于es执行搜索和分析可以达到秒级。")]),t._v(" "),a("h2",{attrs:{id:"_2-2-集群-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-集群-cluster"}},[t._v("#")]),t._v(" 2.2 集群-Cluster")]),t._v(" "),a("p",[t._v("包含多个节点，每个节点属于哪个集群是通过一个配置（集群名称，默认是elasticsearch）决定。\n对于中小型应用来说，刚开始一个集群就一个节点很正常。")]),t._v(" "),a("h2",{attrs:{id:"_2-3-节点-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-节点-node"}},[t._v("#")]),t._v(" 2.3 节点-Node")]),t._v(" "),a("p",[t._v("集群中的一个节点，节点也有一个名称（默认是随机分配的），节点名称很重要（在执行运维管理操作的时候），默认节点会去加入一个名称为“elasticsearch”的集群，如果直接启动一堆节点，那么它们会自动组成一个elasticsearch集群，当然一个节点也可以组成一个elasticsearch集群")]),t._v(" "),a("h2",{attrs:{id:"_2-4-索引-index-表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-索引-index-表"}},[t._v("#")]),t._v(" 2.4 索引-Index(表)")]),t._v(" "),a("p",[t._v("由具有相同字段的文档列表组成，包含一堆相似结构的文档数据。")]),t._v(" "),a("p",[t._v("比如可以有一个客户索引，商品分类索引，订单索引。索引有一个名称\n一个index包含很多document，一个index就代表了一类类似/相同的document。")]),t._v(" "),a("p",[t._v("比如建立一个product index 商品索引，里面可能就存放了所有的商品数据（商品document）。")]),t._v(" "),a("p",[t._v("索引中存储具有相同结构的文档(Document)")]),t._v(" "),a("ul",[a("li",[t._v("每个索引都有自己的"),a("code",[t._v("mapping")]),t._v("定义（类似 MySQL 的 schema），用于定义字段名和类型")]),t._v(" "),a("li",[t._v("一个集群可以有多个索引，比如\n"),a("ul",[a("li",[t._v("nginx日志存储的时候可以按照日期每天生成一个索引来存储\nnginx-log-2020-01-01\nnginx-log-2020-01-02\nnginx-log-2020-01-03")])])])]),t._v(" "),a("h2",{attrs:{id:"_2-5-document-field-行-列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-document-field-行-列"}},[t._v("#")]),t._v(" 2.5 Document & field（行 & 列）")]),t._v(" "),a("h3",{attrs:{id:"document"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#document"}},[t._v("#")]),t._v(" document")]),t._v(" "),a("p",[t._v("JSON结构，用户存储在 ES 中的数据文档。一个document可以是一条客户数据，一条商品分类数据，一条订单数据。由字段 Filed 组成。")]),t._v(" "),a("p",[t._v("每个文档有唯一的id标识：")]),t._v(" "),a("ul",[a("li",[t._v("自行指定")]),t._v(" "),a("li",[t._v("es自动生成")])]),t._v(" "),a("h4",{attrs:{id:"数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型"}},[t._v("#")]),t._v(" 数据类型")]),t._v(" "),a("ul",[a("li",[t._v("字符串\ntext, keyword")]),t._v(" "),a("li",[t._v("数值型\nlong, integer, short, byte, double, float half_float, scaled_float")]),t._v(" "),a("li",[t._v("布尔\nboolean")]),t._v(" "),a("li",[t._v("日期\ndate")]),t._v(" "),a("li",[t._v("二进制\nbinary")]),t._v(" "),a("li",[t._v("范围类型\ninteger_range, float_range, long_range, double_range, date_ range")])]),t._v(" "),a("h4",{attrs:{id:"元数据-用于标注文档的相关信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#元数据-用于标注文档的相关信息"}},[t._v("#")]),t._v(" 元数据-用于标注文档的相关信息")]),t._v(" "),a("ul",[a("li",[t._v("_ index: 文档所在的索引名")]),t._v(" "),a("li",[t._v("_type: 文档所在的类型名")]),t._v(" "),a("li",[t._v("_id:文档唯一id")]),t._v(" "),a("li",[t._v("_uid：组合id,由type和. jid 组成(ES 6.x开始 "),a("code",[t._v("_type")]),t._v("不再起作用，同_id)")]),t._v(" "),a("li",[t._v("_source：文档原始JSON数据，可以从这里获取每个字段的内容")]),t._v(" "),a("li",[t._v("_all：整合所有字段内容到该字段，默认禁用，因其针对所有字段内容分词，很占磁盘空间")])]),t._v(" "),a("h3",{attrs:{id:"field"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#field"}},[t._v("#")]),t._v(" field")]),t._v(" "),a("p",[t._v("每个index下的type，都可以存储多个document。一个document里面有多个field，每个field就是一个数据字段列。")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("product document\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JavaEdge 公众号"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_desc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"全是技术干货"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"技术追求"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h2",{attrs:{id:"_2-6-shard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-shard"}},[t._v("#")]),t._v(" 2.6 shard")]),t._v(" "),a("p",[t._v("单台机器无法存储大量数据，es可以将一个索引中的数据切分为多个shard，分布在多台服务器上存储\n有了shard就可以横向扩展，存储更多数据，让搜索和分析等操作分布到多台服务器上去执行，提升吞吐量和性能\n每个shard都是一个lucene index。")]),t._v(" "),a("h2",{attrs:{id:"_2-7-replica"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-7-replica"}},[t._v("#")]),t._v(" 2.7 replica")]),t._v(" "),a("p",[t._v("任何一个服务器随时可能故障或宕机，此时shard可能就会丢失，因此可以为每个shard创建多个replica副本。\nreplica可以在shard故障时提供备用服务，保证数据不丢失，多个replica还可以提升搜索操作的吞吐量和性能。primary shard（建立索引时一次设置，不能修改，默认5个），replica shard（随时修改数量，默认1个），默认每个索引10个shard，5个primary shard，5个replica shard，最小的高可用配置，是2台服务器。")]),t._v(" "),a("ul",[a("li",[t._v("shard和replica的解释\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20191117222016634.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9qYXZhZWRnZS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70",alt:""}})])]),t._v(" "),a("h2",{attrs:{id:"类型-type-表逻辑类型-es-7-x中已废除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型-type-表逻辑类型-es-7-x中已废除"}},[t._v("#")]),t._v(" 类型 Type（表逻辑类型）ES 7.x中已废除")]),t._v(" "),a("p",[t._v("每个index都可有一或多个type，type是index的一个逻辑数据分类。\n一个type下的document，都有相同field。\n比如博客系统，有一个索引，可定义用户数据type，博客数据type，评论数据type。")]),t._v(" "),a("p",[t._v("商品index，里面存放了所有的商品数据，商品document\n但是商品分很多种类，每个种类的document的field可能不太一样\n比如说电器商品，可能还包含一些诸如售后时间范围这样的特殊field；生鲜商品，还包含一些诸如生鲜保质期之类的特殊field")]),t._v(" "),a("p",[t._v("type，日化商品type，电器商品type，生鲜商品type")]),t._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[t._v("日化商品"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v("：product_id，product_name，product_desc，category_id，category_name\n电器商品"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v("：product_id，product_name，product_desc，category_id，category_name，service_period\n生鲜商品"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v("：product_id，product_name，product_desc，category_id，category_name，eat_period\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("每个type里，包含一堆document")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"长虹电视机"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_desc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4k高清"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"电器"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"service_period"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1年"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"基围虾"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"product_desc"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"纯天然，冰岛产"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"4"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"category_name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"生鲜"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"eat_period"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"7天"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("h1",{attrs:{id:"_3-restful-api-representational-state-transfer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-restful-api-representational-state-transfer"}},[t._v("#")]),t._v(" 3 RESTful API（REpresentational State Transfer）")]),t._v(" "),a("p",[t._v("Elasticsearch 集群对外提供RESTful API")]),t._v(" "),a("ul",[a("li",[t._v("URI 指定资源 , 如 Index、Document等")]),t._v(" "),a("li",[t._v("Http Method 指明资源操作类型，如GET、POST、 PUT、DELETE")])]),t._v(" "),a("h2",{attrs:{id:"交互方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#交互方式"}},[t._v("#")]),t._v(" 交互方式")]),t._v(" "),a("ul",[a("li",[t._v("curl 命令行")]),t._v(" "),a("li",[t._v("Kibana DevTools\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201129010757614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70",alt:""}})])])])}),[],!1,null,null,null);s.default=r.exports}}]);