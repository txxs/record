(window.webpackJsonp=window.webpackJsonp||[]).push([[1127],{1522:function(n,a,s){"use strict";s.r(a);var t=s(13),e=Object(t.a)({},(function(){var n=this,a=n.$createElement,s=n._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h1",{attrs:{id:"_1-mybatis的初始化做了什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-mybatis的初始化做了什么"}},[n._v("#")]),n._v(" 1 MyBatis的初始化做了什么")]),n._v(" "),s("p",[n._v("任何框架的初始化，无非是加载自己运行时所需要的配置信息。MyBatis的配置信息，大概包含以下信息，其高层级结构如下：\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-0c45dabf64e579f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),n._v("\nMyBatis的上述配置信息会配置在XML配置文件中，那么，这些信息被加载进入MyBatis内部，MyBatis是怎样维护的呢？")]),n._v(" "),s("p",[n._v("MyBatis采用了一个非常直白和简单的方式---使用 "),s("code",[n._v("org.apache.ibatis.session.Configuration")]),n._v("对象作为一个所有配置信息的容器，Configuration对象的组织结构和XML配置文件的组织结构几乎完全一样\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-3a368ed13c5c304f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),n._v("\nMyBatis根据初始化好Configuration信息，这时候用户就可以使用MyBatis进行数据库操作了")]),n._v(" "),s("p",[s("strong",[n._v("可以这么说，MyBatis初始化的过程，就是创建 Configuration对象的过程。")]),n._v("\nMyBatis的初始化可以有两种方式：")]),n._v(" "),s("blockquote",[s("ul",[s("li",[n._v("基于XML配置文件：基于XML配置文件的方式是将MyBatis的所有配置信息放在XML文件中，MyBatis通过加载并XML配置文件，将配置文信息组装成内部的Configuration对象")]),n._v(" "),s("li",[n._v("基于Java API：这种方式不使用XML配置文件，需要MyBatis使用者在Java代码中，手动创建Configuration对象，然后将配置参数set 进入Configuration对象中\n接下来我们将通过 基于XML配置文件方式的MyBatis初始化，深入探讨MyBatis是如何通过配置文件构建Configuration对象，并使用它的。")])])]),n._v(" "),s("h1",{attrs:{id:"_2-mybatis基于xml配置文件创建configuration对象的过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mybatis基于xml配置文件创建configuration对象的过程"}},[n._v("#")]),n._v(" 2 MyBatis基于XML配置文件创建Configuration对象的过程")]),n._v(" "),s("p",[n._v("现在就从使用MyBatis的简单例子入手，深入分析一下MyBatis是怎样完成初始化的，都初始化了什么")]),n._v(" "),s("p",[n._v("有过MyBatis使用经验的读者会知道，上述语句的作用是执行"),s("strong",[n._v("com.foo.bean.BlogMapper.queryAllBlogInfo")]),n._v(" 定义的SQL语句，返回一个List结果集\n总的来说，上述代码经历了\n"),s("strong",[n._v("mybatis初始化 --\x3e创建SqlSession --\x3e执行SQL语句")]),n._v("\n返回结果三个过程。")]),n._v(" "),s("p",[n._v("上述代码的功能是根据配置文件mybatis-config.xml  配置文件，创建SqlSessionFactory对象，然后产生SqlSession，执行SQL语句\n而mybatis的初始化就发生在第三句")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);  \n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[n._v("现在就让我们看看第三句到底发生了什么。")]),n._v(" "),s("h1",{attrs:{id:"_2-mybatis初始化基本过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mybatis初始化基本过程"}},[n._v("#")]),n._v(" 2 "),s("strong",[n._v("MyBatis初始化基本过程")])]),n._v(" "),s("p",[s("strong",[n._v("SqlSessionFactoryBuilder根据传入的数据流生成Configuration对象，然后根据Configuration对象创建默认的SqlSessionFactory实例。")]),n._v(" "),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-ce21b0677a44f26b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),n._v("\n由上图所示，mybatis初始化要经过简单的以下几步")]),n._v(" "),s("ul",[s("li",[n._v("调用SqlSessionFactoryBuilder对象的build(inputStream)方法\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-a5c1546967283fba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})]),n._v(" "),s("li",[n._v("SqlSessionFactoryBuilder会根据输入流inputStream等信息创建XMLConfigBuilder对象")]),n._v(" "),s("li",[n._v("SqlSessionFactoryBuilder调用XMLConfigBuilder对象的parse()方法\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-6271cc4234a5b7bf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})]),n._v(" "),s("li",[n._v("XMLConfigBuilder对象返回Configuration对象")]),n._v(" "),s("li",[n._v("SqlSessionFactoryBuilder根据Configuration对象创建一个DefaultSessionFactory对象\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-29392888c3913ea0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})]),n._v(" "),s("li",[n._v("SqlSessionFactoryBuilder返回 DefaultSessionFactory对象给Client，供Client使用")])]),n._v(" "),s("p",[n._v("上述的初始化过程中，涉及到了以下几个对象：")]),n._v(" "),s("ul",[s("li",[n._v("SqlSessionFactoryBuilder ： SqlSessionFactory的构造器，用于创建SqlSessionFactory，采用了Builder设计模式")]),n._v(" "),s("li",[n._v("Configuration ：该对象是mybatis-config.xml文件中所有mybatis配置信息")]),n._v(" "),s("li",[n._v("SqlSessionFactory：SqlSession工厂类，以工厂形式创建SqlSession对象，采用了工厂设计模式")]),n._v(" "),s("li",[n._v("XmlConfigParser ：负责将mybatis-config.xml配置文件解析成Configuration对象，共SqlSessonFactoryBuilder使用，创建SqlSessionFactory")])]),n._v(" "),s("h1",{attrs:{id:"_3-创建configuration对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建configuration对象"}},[n._v("#")]),n._v(" 3 创建Configuration对象")]),n._v(" "),s("p",[n._v("SqlSessionFactoryBuilder执行build()方法，调用了XMLConfigBuilder的parse()方法，然后返回了Configuration对象。那么parse()方法是如何处理XML文件，生成Configuration对象的呢？")]),n._v(" "),s("ul",[s("li",[n._v("XMLConfigBuilder会将XML配置文件的信息转换为Document对象，而XML配置定义文件DTD转换成XMLMapperEntityResolver对象，然后将二者封装到XpathParser对象中，XpathParser的作用是"),s("strong",[n._v("提供根据Xpath表达式获取基本的DOM节点Node信息的操作")]),n._v(" "),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-c3eab1987c538598.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),n._v(" "),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-a9ef1bb384b05601.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),n._v("\n之后XMLConfigBuilder调用parse()方法：会从XPathParser中取出 "),s("configuration",[n._v("节点对应的Node对象，然后解析此Node节点的子Node：properties, settings, typeAliases,typeHandlers, objectFactory, objectWrapperFactory, plugins, environments,databaseIdProvider, mappers")])],1)]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('    public Configuration parse()\n    {\n        if (parsed)\n        {\n            throw new BuilderException("Each XMLConfigBuilder can only be used once.");\n        }\n        parsed = true;\n        //源码中没有这一句，只有 parseConfiguration(parser.evalNode("/configuration"));\n        //为了让读者看得更明晰，源码拆分为以下两句\n        XNode configurationNode = parser.evalNode("/configuration");\n        parseConfiguration(configurationNode);\n        return configuration;\n    }\n    /*\n    解析 "/configuration"节点下的子节点信息，然后将解析的结果设置到Configuration对象中\n    */\n  private void parseConfiguration(XNode root) {\n    try {\n      //1.首先处理properties 节点\t\n      propertiesElement(root.evalNode("properties")); //issue #117 read properties first\n      //2.处理typeAliases\n      typeAliasesElement(root.evalNode("typeAliases"));\n      //3.处理插件\n      pluginElement(root.evalNode("plugins"));\n      //4.处理objectFactory\n      objectFactoryElement(root.evalNode("objectFactory"));\n      //5.objectWrapperFactory\n      objectWrapperFactoryElement(root.evalNode("objectWrapperFactory"));\n      //6.settings\n      settingsElement(root.evalNode("settings"));\n      //7.处理environments\n      environmentsElement(root.evalNode("environments")); // read it after objectFactory and objectWrapperFactory issue #631\n      //8.database\n      databaseIdProviderElement(root.evalNode("databaseIdProvider"));\n      //9. typeHandlers\n      typeHandlerElement(root.evalNode("typeHandlers"));\n      //10 mappers\n      mapperElement(root.evalNode("mappers"));\n    } catch (Exception e) {\n      throw new BuilderException("Error parsing SQL Mapper Configuration. Cause: " + e, e);\n    }\n  }\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br")])]),s("ul",[s("li",[n._v('然后将这些值解析出来设置到Configuration对象中\n解析子节点的过程这里就不一一介绍了，用户可以参照MyBatis源码仔细揣摩，我们就看上述的environmentsElement(root.evalNode("environments")); 方法是如何将environments的信息解析出来，设置到Configuration对象中的')])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('/*\n   解析environments节点，并将结果设置到Configuration对象中\n   注意：创建envronment时，如果SqlSessionFactoryBuilder指定了特定的环境（即数据源）；\n         则返回指定环境（数据源）的Environment对象，否则返回默认的Environment对象；\n         这种方式实现了MyBatis可以连接多数据源\n*/\nprivate void environmentsElement(XNode context) throws Exception\n{\n    if (context != null)\n    {\n        if (environment == null)\n        {\n            environment = context.getStringAttribute("default");\n        }\n        for (XNode child : context.getChildren())\n        {\n            String id = child.getStringAttribute("id");\n            if (isSpecifiedEnvironment(id))\n            {\n                //1.创建事务工厂 TransactionFactory\n                TransactionFactory txFactory = transactionManagerElement(child.evalNode("transactionManager"));\n                DataSourceFactory dsFactory = dataSourceElement(child.evalNode("dataSource"));\n                //2.创建数据源DataSource\n                DataSource dataSource = dsFactory.getDataSource();\n                //3. 构造Environment对象\n                Environment.Builder environmentBuilder = new Environment.Builder(id)\n                .transactionFactory(txFactory)\n                .dataSource(dataSource);\n                //4. 将创建的Envronment对象设置到configuration 对象中\n                configuration.setEnvironment(environmentBuilder.build());\n            }\n        }\n    }\n}\nprivate boolean isSpecifiedEnvironment(String id)\n{\n    if (environment == null)\n    {\n        throw new BuilderException("No environment specified.");\n    }\n    else if (id == null)\n    {\n        throw new BuilderException("Environment requires an id attribute.");\n    }\n    else if (environment.equals(id))\n    {\n        return true;\n    }\n    return false;\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br")])]),s("ul",[s("li",[n._v("返回Configuration对象\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-5ac113150029374b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"MyBatis初始化基本过程的序列图"}})])]),n._v(" "),s("h1",{attrs:{id:"_4-手动加载xml配置文件创建configuration对象完成初始化-创建并使用sqlsessionfactory对象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-手动加载xml配置文件创建configuration对象完成初始化-创建并使用sqlsessionfactory对象"}},[n._v("#")]),n._v(" 4 手动加载XML配置文件创建Configuration对象完成初始化，创建并使用SqlSessionFactory对象")]),n._v(" "),s("p",[n._v("我们可以使用XMLConfigBuilder手动解析XML配置文件来创建Configuration对象，代码如下\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-7f716a450062bcfc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})]),n._v(" "),s("h1",{attrs:{id:"_5-涉及到的设计模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-涉及到的设计模式"}},[n._v("#")]),n._v(" 5 涉及到的设计模式")]),n._v(" "),s("h2",{attrs:{id:"_5-1-builder模式应用1-sqlsessionfactory的创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-builder模式应用1-sqlsessionfactory的创建"}},[n._v("#")]),n._v(" 5.1 "),s("strong",[n._v("Builder模式应用1： SqlSessionFactory的创建")])]),n._v(" "),s("p",[n._v("对于创建SqlSessionFactory时，会根据情况提供不同的参数，其参数组合可以有以下几种\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-0951bb9c904e8a45.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),n._v("\n由于构造时参数不定，可以为其创建一个构造器Builder，将SqlSessionFactory的构建过程和表示分开\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-3e834245c96bf463.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:" MyBatis将SqlSessionFactoryBuilder和SqlSessionFactory相互独立"}})]),n._v(" "),s("h2",{attrs:{id:"_5-2-builder模式应用2-数据库连接环境environment对象的创建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-builder模式应用2-数据库连接环境environment对象的创建"}},[n._v("#")]),n._v(" 5.2 "),s("strong",[n._v("Builder模式应用2： 数据库连接环境Environment对象的创建")])]),n._v(" "),s("p",[n._v("在构建Configuration对象的过程中，XMLConfigParser解析 mybatis XML配置文件节点"),s("environment",[n._v("节点时，会有以下相应的代码")])],1),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('  private void environmentsElement(XNode context) throws Exception {\n    if (context != null) {\n      if (environment == null) {\n        environment = context.getStringAttribute("default");\n      }\n      for (XNode child : context.getChildren()) {\n        String id = child.getStringAttribute("id");\n        //是和默认的环境相同时，解析之\n        if (isSpecifiedEnvironment(id)) {\n          TransactionFactory txFactory = transactionManagerElement(child.evalNode("transactionManager"));\n          DataSourceFactory dsFactory = dataSourceElement(child.evalNode("dataSource"));\n          DataSource dataSource = dsFactory.getDataSource();\n \n          //使用了Environment内置的构造器Builder，传递id 事务工厂和数据源\n          Environment.Builder environmentBuilder = new Environment.Builder(id)\n              .transactionFactory(txFactory)\n              .dataSource(dataSource);\n          configuration.setEnvironment(environmentBuilder.build());\n        }\n      }\n    }\n  }\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br")])]),s("p",[n._v("在Environment内部，定义了静态内部Builder类")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("public final class Environment {\n  private final String id;\n  private final TransactionFactory transactionFactory;\n  private final DataSource dataSource;\n \n  public Environment(String id, TransactionFactory transactionFactory, DataSource dataSource) {\n    if (id == null) {\n      throw new IllegalArgumentException(\"Parameter 'id' must not be null\");\n    }\n    if (transactionFactory == null) {\n        throw new IllegalArgumentException(\"Parameter 'transactionFactory' must not be null\");\n    }\n    this.id = id;\n    if (dataSource == null) {\n      throw new IllegalArgumentException(\"Parameter 'dataSource' must not be null\");\n    }\n    this.transactionFactory = transactionFactory;\n    this.dataSource = dataSource;\n  }\n \n  public static class Builder {\n      private String id;\n      private TransactionFactory transactionFactory;\n      private DataSource dataSource;\n \n    public Builder(String id) {\n      this.id = id;\n    }\n \n    public Builder transactionFactory(TransactionFactory transactionFactory) {\n      this.transactionFactory = transactionFactory;\n      return this;\n    }\n \n    public Builder dataSource(DataSource dataSource) {\n      this.dataSource = dataSource;\n      return this;\n    }\n \n    public String id() {\n      return this.id;\n    }\n \n    public Environment build() {\n      return new Environment(this.id, this.transactionFactory, this.dataSource);\n    }\n \n  }\n \n  public String getId() {\n    return this.id;\n  }\n \n  public TransactionFactory getTransactionFactory() {\n    return this.transactionFactory;\n  }\n \n  public DataSource getDataSource() {\n    return this.dataSource;\n  }\n \n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);