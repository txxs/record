(window.webpackJsonp=window.webpackJsonp||[]).push([[1128],{1520:function(t,_,s){"use strict";s.r(_);var v=s(13),a=Object(v.a)({},(function(){var t=this,_=t.$createElement,s=t._self._c||_;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("MyBatis的二级缓存是Application级别的缓存，它可以提高对数据库查询的效率，以提高应用的性能")]),t._v(" "),s("h1",{attrs:{id:"_1-mybatis的缓存机制整体设计以及二级缓存的工作模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-mybatis的缓存机制整体设计以及二级缓存的工作模式"}},[t._v("#")]),t._v(" "),s("strong",[t._v("1.MyBatis的缓存机制整体设计以及二级缓存的工作模式")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-e32166d46c88d99c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),t._v("\n当开一个会话时，一个"),s("strong",[t._v("SqlSession")]),t._v("对象会使用一个"),s("strong",[t._v("Executor")]),t._v("对象来完成会话操作，"),s("strong",[t._v("MyBatis")]),t._v("的二级缓存机制的关键就是对这个"),s("strong",[t._v("Executor")]),t._v("对象做文章\n如果用户配置了"),s("code",[t._v("cacheEnabled=true")]),t._v("，那么"),s("strong",[t._v("MyBatis")]),t._v("在为"),s("strong",[t._v("SqlSession")]),t._v("对象创建"),s("strong",[t._v("Executor")]),t._v("对象时，会对"),s("strong",[t._v("Executor")]),t._v("对象加上一个装饰者："),s("strong",[t._v("CachingExecutor")]),t._v("，这时"),s("strong",[t._v("SqlSession")]),t._v("使用"),s("strong",[t._v("CachingExecutor")]),t._v("对象来完成操作请求\n"),s("strong",[t._v("CachingExecutor")]),t._v("对于查询请求，会先判断该查询请求在"),s("strong",[t._v("Application")]),t._v("级别的二级缓存中是否有缓存结果")]),t._v(" "),s("ul",[s("li",[t._v("如果有查询结果，则直接返回缓存结果")]),t._v(" "),s("li",[t._v("如果缓存中没有，再交给真正的"),s("strong",[t._v("Executor")]),t._v("对象来完成查询操作，之后"),s("strong",[t._v("CachingExecutor")]),t._v("会将真正"),s("strong",[t._v("Executor")]),t._v("返回的查询结果放置到缓存中，然后在返回给用户\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-dc5734c32ff28aeb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}}),t._v(" "),s("strong",[t._v("CachingExecutor")]),t._v("是"),s("strong",[t._v("Executor")]),t._v("的装饰者，以增强"),s("strong",[t._v("Executor")]),t._v("的功能，使其具有"),s("code",[t._v("缓存查询")]),t._v("功能，这里用到了设计模式中的装饰者模式，\n"),s("strong",[t._v("CachingExecutor")]),t._v("和"),s("strong",[t._v("Executor")]),t._v("的接口的关系如下类图所示：\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-ac36596f0e769458.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})])]),t._v(" "),s("h1",{attrs:{id:"_2-mybatis二级缓存的划分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-mybatis二级缓存的划分"}},[t._v("#")]),t._v(" 2 MyBatis二级缓存的划分")]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("并不是简单地对整个"),s("strong",[t._v("Application")]),t._v("就只有一个"),s("strong",[t._v("Cache")]),t._v("缓存对象，它将缓存划分的更细，即是"),s("strong",[t._v("Mapper")]),t._v("级别的，即每一个Mapper都可以拥有一个"),s("strong",[t._v("Cache")]),t._v("对象，具体如下：")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("a.为每一个Mapper分配一个Cache缓存对象（使用"),s("cache",[t._v("节点配置）")])],1),t._v(" "),s("strong",[t._v("b.多个Mapper共用一个Cache缓存对象（使用"),s("cache-ref",[t._v("节点配置）")])],1),t._v("\n如果你想让多个"),s("strong",[t._v("Mapper")]),t._v("公用一个"),s("strong",[t._v("Cache")]),t._v("的话，你可以使用**"),s("cache-ref",{attrs:{namespace:""}},[s("strong",[t._v("节点，来指定你的这个")]),t._v("Mapper"),s("strong",[t._v("使用到了哪一个")]),t._v("Mapper"),s("strong",[t._v("的")]),t._v("Cache**缓存\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-1f143322892bf4b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})])],1)]),t._v(" "),s("h1",{attrs:{id:"_3-使用二级缓存-必须要具备的条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用二级缓存-必须要具备的条件"}},[t._v("#")]),t._v(" "),s("strong",[t._v("3 使用二级缓存，必须要具备的条件")])]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("对二级缓存的支持粒度很细，它会指定某一条查询语句是否使用二级缓存")]),t._v(" "),s("p",[t._v("虽然在"),s("strong",[t._v("Mapper")]),t._v("中配置了**"),s("cache",[s("strong",[t._v(",并且为此")]),t._v("Mapper"),s("strong",[t._v("分配了")]),t._v("Cache"),s("strong",[t._v("对象，这并不表示我们使用")]),t._v("Mapper"),s("strong",[t._v("中定义的查询语句查到的结果都会放置到")]),t._v("Cache"),s("strong",[t._v("对象之中\n必须指定")]),t._v("Mapper"),s("strong",[t._v("中的某条选择语句是否支持缓存，即如下所示，在")]),s("select",[s("strong",[t._v("节点中配置")]),t._v('useCache="true"'),s("strong",[t._v("，"),s("strong",[t._v("Mapper")]),t._v("才会对此")]),t._v("Select"),s("strong",[t._v("的查询支持缓存，否则，不会对此")]),t._v("Select"),s("strong",[t._v("查询，不会经过")]),t._v("Cache"),s("strong",[t._v("缓存\n如下，"),s("strong",[t._v("Select")]),t._v("语句配置了")]),t._v('useCache="true"'),s("strong",[t._v("，则表明这条")]),t._v("Select**语句的查询会使用二级缓存。")])])],1),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(' <select id="selectByMinSalary" resultMap="BaseResultMap" parameterType="java.util.Map" useCache="true">\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("总之，要想使某条"),s("strong",[t._v("Select")]),t._v("查询支持二级缓存，你需要保证")]),t._v(" "),s("blockquote",[s("p",[t._v("1.  MyBatis支持二级缓存的总开关：全局配置变量参数   cacheEnabled=true\n2 该select语句所在的Mapper，配置了"),s("cache",[t._v(" 或"),s("cached-ref",[t._v("节点，并且有效\n3 该select语句的参数 useCache=true")])],1)],1)]),t._v(" "),s("h1",{attrs:{id:"_4-一级缓存和二级缓存的使用顺序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-一级缓存和二级缓存的使用顺序"}},[t._v("#")]),t._v(" 4 一级缓存和二级缓存的使用顺序")]),t._v(" "),s("p",[t._v("如果你的"),s("strong",[t._v("MyBatis")]),t._v("使用了二级缓存，并且"),s("strong",[t._v("Mapper")]),t._v("和"),s("strong",[t._v("select")]),t._v("语句也配置使用了二级缓存，那么在执行"),s("strong",[t._v("select")]),t._v("查询的时候，"),s("strong",[t._v("MyBatis")]),t._v("会先从二级缓存中取输入，其次才是一级缓存，即"),s("strong",[t._v("MyBatis")]),t._v("查询数据的顺序是：\n"),s("code",[t._v("二级缓存    ———> 一级缓存——> 数据库")])]),t._v(" "),s("h1",{attrs:{id:"_5-二级缓存实现的选择"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-二级缓存实现的选择"}},[t._v("#")]),t._v(" "),s("strong",[t._v("5 二级缓存实现的选择")])]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("对二级缓存的设计非常灵活，它自己内部实现了一系列的"),s("strong",[t._v("Cache")]),t._v("缓存实现类，并提供了各种缓存刷新策略如"),s("strong",[t._v("LRU，FIFO")]),t._v("等等\n另外，"),s("strong",[t._v("MyBatis")]),t._v("还允许用户自定义"),s("strong",[t._v("Cache")]),t._v("接口实现，用户是需要实现"),s("strong",[t._v("org.apache.ibatis.cache.Cache")]),t._v("接口，然后将"),s("strong",[t._v("Cache")]),t._v("实现类配置在**"),s("cache",{attrs:{type:""}},[s("strong",[t._v("节点的")]),t._v("type"),s("strong",[t._v("属性上即可\n除此之外，"),s("strong",[t._v("MyBatis")]),t._v("还支持跟第三方内存缓存库如")]),t._v("Memecached"),s("strong",[t._v("的集成，总之，使用")]),t._v("MyBatis**的二级缓存有三个选择")])],1),t._v(" "),s("ul",[s("li",[s("strong",[t._v("1.MyBatis自身提供的缓存实现")])]),t._v(" "),s("li",[s("strong",[t._v("2. 用户自定义的Cache接口实现")])]),t._v(" "),s("li",[s("strong",[t._v("3.跟第三方内存缓存库的集成")])])]),t._v(" "),s("h1",{attrs:{id:"_6-mybatis自身提供的二级缓存的实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-mybatis自身提供的二级缓存的实现"}},[t._v("#")]),t._v(" "),s("strong",[t._v("6.  MyBatis自身提供的二级缓存的实现")])]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("自身提供了丰富的，并且功能强大的二级缓存的实现，它拥有一系列的"),s("strong",[t._v("Cache")]),t._v("接口装饰者，可以满足各种对缓存操作和更新的策略。")]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("定义了大量的"),s("strong",[t._v("Cache")]),t._v("的装饰器来增强"),s("strong",[t._v("Cache")]),t._v("缓存的功能")]),t._v(" "),s("p",[t._v("对于每个"),s("strong",[t._v("Cache")]),t._v("而言，都有一个容量限制，"),s("strong",[t._v("MyBatis")]),t._v("提供了各种策略来对"),s("strong",[t._v("Cache")]),t._v("缓存的容量进行控制，以及对"),s("strong",[t._v("Cache")]),t._v("中的数据进行刷新和置换")]),t._v(" "),s("p",[s("strong",[t._v("MyBatis")]),t._v("主要提供了以下几个刷新和置换策略：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("LRU：（Least Recently Used）")]),t._v(",最近最少使用算法，即如果缓存中容量已经满了，会将缓存中最近做少被使用的缓存记录清除掉，然后添加新的记录；\n- "),s("strong",[t._v("FIFO：（First in first out）")]),t._v(",先进先出算法，如果缓存中的容量已经满了，那么会将最先进入缓存中的数据清除掉；")]),t._v(" "),s("li",[s("strong",[t._v("Scheduled")]),t._v("：指定时间间隔清空算法，该算法会以指定的某一个时间间隔将"),s("strong",[t._v("Cache")]),t._v("缓存中的数据清空；\n"),s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/4685968-8b2d02da1e76cb22.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:""}})])]),t._v(" "),s("h1",{attrs:{id:"_6-写在后面-关于涉及到的设计模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-写在后面-关于涉及到的设计模式"}},[t._v("#")]),t._v(" "),s("strong",[t._v("6 写在后面（关于涉及到的设计模式）")])]),t._v(" "),s("p",[t._v("在二级缓存的设计上，MyBatis大量地运用了装饰者模式，如CachingExecutor, 以及各种Cache接口的装饰器")])])}),[],!1,null,null,null);_.default=a.exports}}]);