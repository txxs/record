(window.webpackJsonp=window.webpackJsonp||[]).push([[1210],{1603:function(s,t,a){"use strict";a.r(t);var e=a(13),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("全是干货的技术号：\n本文已收录在github，欢迎 star/fork：\nhttps://github.com/Wasabi1234/Java-Interview-Tutorial")])]),s._v(" "),a("h1",{attrs:{id:"_1-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-简介"}},[s._v("#")]),s._v(" 1 简介")]),s._v(" "),a("p",[s._v("二进制日志，记录对数据发生或潜在发生更改的SQL语句，并以二进制形式保存在磁盘。")]),s._v(" "),a("h1",{attrs:{id:"_2-binlog-的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-binlog-的作用"}},[s._v("#")]),s._v(" 2 Binlog 的作用")]),s._v(" "),a("p",[s._v("复制、恢复和审计。")]),s._v(" "),a("h1",{attrs:{id:"_3-开启binlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-开启binlog"}},[s._v("#")]),s._v(" 3 开启Binlog")]),s._v(" "),a("h2",{attrs:{id:"_3-1-查询当前-mysql-是否支持-binlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-查询当前-mysql-是否支持-binlog"}},[s._v("#")]),s._v(" 3.1 查询当前 MySQL 是否支持 binlog")]),s._v(" "),a("p",[s._v("如下OFF代表不支持\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226103658150.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226103724662.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_3-2-修改-my-cnf-文件以支持-binlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-修改-my-cnf-文件以支持-binlog"}},[s._v("#")]),s._v(" 3.2 修改 my.cnf 文件以支持 binlog")]),s._v(" "),a("h3",{attrs:{id:"查看my-cnf路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看my-cnf路径"}},[s._v("#")]),s._v(" 查看my.cnf路径")]),s._v(" "),a("ul",[a("li",[s._v("mysql --help --verbose | grep my.cnf\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226145447126.png",alt:"mysql --help --verbose | grep my.cnf"}}),s._v(" "),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226145609552.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_16,color_FFFFFF,t_70",alt:""}})])]),s._v(" "),a("h3",{attrs:{id:"在-etc-新建文件my-cnf并添加如下内容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-etc-新建文件my-cnf并添加如下内容"}},[s._v("#")]),s._v(" 在/etc 新建文件my.cnf并添加如下内容")]),s._v(" "),a("ul",[a("li",[s._v("注意添加 mysqld 组\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226151409568.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_16,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("li",[s._v("重启 MySQL"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226151443363.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_16,color_FFFFFF,t_70",alt:""}})]),s._v(" "),a("li",[s._v("再次查看是否支持binlog"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20190226151707772.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_16,color_FFFFFF,t_70",alt:""}})])]),s._v(" "),a("h1",{attrs:{id:"_3-binlog管理命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-binlog管理命令"}},[s._v("#")]),s._v(" 3 binlog管理命令")]),s._v(" "),a("h2",{attrs:{id:"show-master-logs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-master-logs"}},[s._v("#")]),s._v(" show master logs")]),s._v(" "),a("ul",[a("li",[s._v("查看所有Binlog的日志列表。\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201008223019405.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70#pic_center",alt:""}})])]),s._v(" "),a("h2",{attrs:{id:"show-master-status"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#show-master-status"}},[s._v("#")]),s._v(" show master status")]),s._v(" "),a("ul",[a("li",[s._v("查看binlog日志状态。查看最后一个Binlog日志的编号名称，及最后一个事件结束的位置( pos )\n"),a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201008223132389.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70#pic_center",alt:""}})])]),s._v(" "),a("h2",{attrs:{id:"flush-logs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flush-logs"}},[s._v("#")]),s._v(" flush logs")]),s._v(" "),a("p",[s._v("刷新binlog日志文件，刷新之后会创建一个新的Binlog日志文件")]),s._v(" "),a("h2",{attrs:{id:"reset-master"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reset-master"}},[s._v("#")]),s._v(" reset master")]),s._v(" "),a("p",[s._v("清空所有的 binlog 日志文件")]),s._v(" "),a("h2",{attrs:{id:"查看binlog日志文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看binlog日志文件"}},[s._v("#")]),s._v(" 查看binlog日志文件")]),s._v(" "),a("p",[s._v("mysqlbinlog mysql-bin.000002")]),s._v(" "),a("h1",{attrs:{id:"_4-binlog相关变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-binlog相关变量"}},[s._v("#")]),s._v(" 4 Binlog相关变量")]),s._v(" "),a("h2",{attrs:{id:"log-bin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#log-bin"}},[s._v("#")]),s._v(" log_bin")]),s._v(" "),a("p",[s._v("Binlog的开关。")]),s._v(" "),a("p",[s._v("查看该变量：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_bin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201008221436787.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70#pic_center",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"binlog-format"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#binlog-format"}},[s._v("#")]),s._v(" binlog_format")]),s._v(" "),a("p",[s._v("Binlog日志的格式。")]),s._v(" "),a("p",[s._v("查看变量：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'binlog_format'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201008221610595.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70#pic_center",alt:""}})]),s._v(" "),a("h1",{attrs:{id:"_5-binlog日志的格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-binlog日志的格式"}},[s._v("#")]),s._v(" 5 Binlog日志的格式")]),s._v(" "),a("h2",{attrs:{id:"row"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#row"}},[s._v("#")]),s._v(" ROW")]),s._v(" "),a("p",[s._v("仅保存记录被修改细节，不记录SQL语句上下文相关信息。")]),s._v(" "),a("h3",{attrs:{id:"优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[s._v("#")]),s._v(" 优点")]),s._v(" "),a("p",[s._v("binlog中可以不记录执行的sql语句的上下文相关的信息，仅需要记录那一条记录被修改成什么了。所以rowlevel的日志内容会非常清楚的记录下每一行数据修改的细节。而且不会出现某些特定情况下的存储过程，或function，以及trigger的调用和触发无法被正确复制的问题")]),s._v(" "),a("h3",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[s._v("#")]),s._v(" 缺点")]),s._v(" "),a("p",[s._v("所有的执行的语句当记录到日志中的时候，都将以每行记录的修改来记录，这样可能会产生大量的日志内容,比如一条update语句，修改多条记录，则binlog中每一条修改都会有记录，这样造成binlog日志量会很大，特别是当执行alter table之类的语句的时候，由于表结构修改，每条记录都发生改变，那么该表每一条记录都会记录到日志中。")]),s._v(" "),a("h2",{attrs:{id:"statement"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#statement"}},[s._v("#")]),s._v(" STATEMENT")]),s._v(" "),a("p",[s._v("每一条会修改数据的 SQL 都会记录在Binlog中。")]),s._v(" "),a("h3",{attrs:{id:"优点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[s._v("#")]),s._v(" 优点")]),s._v(" "),a("p",[s._v("无需记录每行变化，减少了binlog日志量，节约了IO，提高性能。\n相比row能节约多少性能与日志量，这个取决于应用的SQL情况，正常同一条记录修改或者插入row格式所产生的日志量还小于Statement产生的日志量，但是考虑到如果带条件的update操作，以及整表删除，alter表等操作，ROW格式会产生大量日志，因此在考虑是否使用ROW格式日志时应该跟据应用的实际情况，其所产生的日志量会增加多少，以及带来的IO性能问题。")]),s._v(" "),a("h3",{attrs:{id:"缺点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[s._v("#")]),s._v(" 缺点")]),s._v(" "),a("p",[s._v("由于记录的只是执行语句，为了这些语句能在slave上正确运行，因此还必须记录每条语句在执行的时候的一些相关信息，以保证所有语句能在slave得到和在master端执行时候相同 的结果。另外mysql 的复制,像一些特定函数功能，slave可与master上要保持一致会有很多相关问题(如sleep()函数， last_insert_id()，以及user-defined functions(udf)会出现问题).")]),s._v(" "),a("h2",{attrs:{id:"mixed"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mixed"}},[s._v("#")]),s._v(" MIXED")]),s._v(" "),a("p",[s._v("以上两种level的混合使用。\n一般的语句修改使用statment格式保存binlog，如一些函数，statement无法完成主从复制的操作，则采用row格式保存binlog,MySQL会根据执行的每一条具体的sql语句来区分对待记录的日志形式，也就是在Statement和Row之间选择一种.新版本的MySQL中队row level模式也被做了优化，并不是所有的修改都会以row level来记录，像遇到表结构变更的时候就会以statement模式来记录。至于update或者delete等修改数据的语句，还是会记录所有行的变更。")]),s._v(" "),a("h2",{attrs:{id:"binlog日志格式选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#binlog日志格式选择"}},[s._v("#")]),s._v(" Binlog日志格式选择")]),s._v(" "),a("p",[s._v("Mysql默认是使用Statement日志格式，推荐使用MIXED.")]),s._v(" "),a("p",[s._v("由于一些特殊使用，可以考虑使用ROWED，如自己通过binlog日志来同步数据的修改，这样会节省很多相关操作。对于binlog数据处理会变得非常轻松,相对mixed，解析也会很轻松(当然前提是增加的日志量所带来的IO开销在容忍的范围内即可)。")]),s._v(" "),a("h2",{attrs:{id:"mysqlbinlog格式选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysqlbinlog格式选择"}},[s._v("#")]),s._v(" mysqlbinlog格式选择")]),s._v(" "),a("p",[s._v("mysql对于日志格式的选定原则:如果是采用 INSERT，UPDATE，DELETE 等直接操作表的情况，则日志格式根据 binlog_format 的设定而记录,如果是采用 GRANT，REVOKE，SET PASSWORD 等管理语句来做的话，那么无论如何 都采用 SBR 模式记录")]),s._v(" "),a("h1",{attrs:{id:"_6-查看binlog相关的sql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-查看binlog相关的sql"}},[s._v("#")]),s._v(" 6 查看Binlog相关的SQL")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" binlog events "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("IN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'log_name'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" pos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("offset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" row_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"查看第一个binlog日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看第一个binlog日志"}},[s._v("#")]),s._v(" 查看第一个Binlog日志")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" binlog events"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201008224623427.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70#pic_center",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"查看指定的binlog日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看指定的binlog日志"}},[s._v("#")]),s._v(" 查看指定的Binlog日志")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" binlog events "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20201008225104881.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_SmF2YUVkZ2U=,size_1,color_FFFFFF,t_70#pic_center",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"从指定的位置开始-查看指定的binlog日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从指定的位置开始-查看指定的binlog日志"}},[s._v("#")]),s._v(" 从指定的位置开始,查看指定的Binlog日志")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("show binlog events "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),s._v(" from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"从指定的位置开始-查看指定的binlog日志-限制查询的条数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从指定的位置开始-查看指定的binlog日志-限制查询的条数"}},[s._v("#")]),s._v(" 从指定的位置开始,查看指定的Binlog日志,限制查询的条数")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("show binlog events "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),s._v(" from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(" limit "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"从指定的位置开始-带有偏移-查看指定的binlog日志-限制查询的条数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#从指定的位置开始-带有偏移-查看指定的binlog日志-限制查询的条数"}},[s._v("#")]),s._v(" 从指定的位置开始，带有偏移，查看指定的Binlog日志,限制查询的条数")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("show binlog events "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),s._v(" from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(" limit "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h1",{attrs:{id:"_7-binlog-列说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-binlog-列说明"}},[s._v("#")]),s._v(" 7 Binlog 列说明")]),s._v(" "),a("h2",{attrs:{id:"event-type"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#event-type"}},[s._v("#")]),s._v(" Event_type")]),s._v(" "),a("ul",[a("li",[s._v("QUERY_ EVENT\n与数据无关的操作，begin、drop table、truncate table等")]),s._v(" "),a("li",[s._v("TABLE "),a("em",[s._v("MAP")]),s._v(" EVENT\n记录下一个操作所对应的表信息，存储了数据库名和表名")]),s._v(" "),a("li",[s._v("XID_ EVENT\n标记事务提交")]),s._v(" "),a("li",[s._v("WRITE_ ROWS_ EVENT\n插入数据,即insert操作")]),s._v(" "),a("li",[s._v("UPDATE_ ROWS_ EVENT\n更新数据,即update操作")]),s._v(" "),a("li",[s._v("DELETE ROWS EVENT\n删除数据,即delete操作")])]),s._v(" "),a("p",[s._v("参考")]),s._v(" "),a("ul",[a("li",[s._v("https://blog.csdn.net/vhomes/article/details/8082734")])])])}),[],!1,null,null,null);t.default=r.exports}}]);